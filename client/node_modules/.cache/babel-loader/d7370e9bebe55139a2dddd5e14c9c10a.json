{"ast":null,"code":"import _slicedToArray from\"/Users/tuphan/Desktop/gcallstest/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import\"./App.css\";import deleteIcon from\"./image/delete.png\";import callIcon from\"./image/call.png\";import endIcon from\"./image/end.png\";import muteIcon from\"./image/mute.png\";import audioIcon from\"./image/audio.png\";import React,{useState,useEffect,Component}from\"react\";import JsSIP from\"jssip\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";require('dotenv').config();var socket;var configuration;var ua;socket=new JsSIP.WebSocketInterface(process.env.REACT_APP_WEBSOCKET);configuration={sockets:[socket],uri:process.env.REACT_APP_URI,password:process.env.REACT_APP_PASSWORD,session_timers:false};ua=new JsSIP.UA(configuration);ua.start();var pos;var duration=0;var timer;var address=\"Unknown\";var internetProtocol=\"Unknown\";var ipUrl=\"https://api.ipify.org?format=json\";fetch(ipUrl).then(function(response){return response.json();}).then(function(jsonData){// jsonData is parsed json object received from url\ninternetProtocol=jsonData.ip;}).catch(function(error){// handle your errors here\nconsole.error(error);});navigator.geolocation.getCurrentPosition(function(position){pos={lng:position.coords.longitude,lat:position.coords.latitude};var url=\"https://api.mapbox.com/geocoding/v5/mapbox.places/\"+pos.lng+\",\"+pos.lat+\".json?access_token=pk.eyJ1IjoidHVzcGhhbmFuaCIsImEiOiJja244eDFyMGkwM3R5MnVvbzI1eWZsYzNuIn0.jm4MGKDtKDMBpLz8IUXyAA\";fetch(url).then(function(response){return response.json();}).then(function(jsonData){// jsonData is parsed json object received from url\naddress=jsonData.features[0].place_name;}).catch(function(error){// handle your errors here\nconsole.error(error);});});JsSIP.debug.enable(\"JsSIP:*\");// Register callbacks to desired call events\nvar eventHandlers={progress:function progress(e){console.log(\"call is in progress\");showCallingContainer();setStatusText(\"Ringing\");},failed:function failed(e){console.log(\"call failed with cause \");setCallButton();setStatusText(\"Call Fail\");if(timer){clearInterval(timer);duration=0;}audio=null;session=null;},ended:function ended(e){console.log(\"call ended with cause \");setCallButton();setStatusText(\"Call End\");if(timer){clearInterval(timer);duration=0;}audio=null;session=null;},confirmed:function confirmed(e){console.log(\"call confirmed\");timer=setInterval(function(){setStatusText(fomatDuration(duration));duration++;},1000);}};var options={eventHandlers:eventHandlers,mediaConstraints:{audio:true,video:false}};var session;var audio;function startCallAudio(phoneNumber){session=ua.call(phoneNumber,options);if(session){session.connection.addEventListener(\"addstream\",function(e){audio=document.createElement(\"audio\");audio.srcObject=e.stream;audio.play();});}}function fomatDuration(time){// Hours, minutes and seconds\nvar secs=~~time%60;var mins=~~(time/60);// Output like \"1:01\" or \"4:03:59\" or \"123:03:59\"\nvar ret=\"\";if(mins>9){ret+=\"\"+mins+\":\"+(secs<10?\"0\":\"\");}else{ret+=\"0\"+mins+\":\"+(secs<10?\"0\":\"\");}ret+=\"\"+secs;return ret;}function setStatusText(status){var statusText=document.getElementById(\"status-text\");statusText.innerHTML=status;}function setCallButton(){var callButton=document.getElementById(\"call-button\");var bol=callButton.getAttribute(\"iscalling\");// Incall\nif(bol===\"true\"){if(session){ua.terminateSessions(options);}callButton.setAttribute(\"iscalling\",\"false\");showNumpad();}// OutCall\nelse{callButton.setAttribute(\"iscalling\",\"true\");showCallingContainer();}}function onAudio(e){var target=e.target;if(target.getAttribute(\"isactive\")===\"true\"){audio.muted=true;target.style.opacity=\"0.6\";target.setAttribute(\"isactive\",\"false\");}else{audio.muted=false;target.style.opacity=\"1\";target.setAttribute(\"isactive\",\"true\");}}function onMute(e){var target=e.target;if(target.getAttribute(\"isactive\")===\"true\"){target.style.opacity=\"0.6\";target.setAttribute(\"isactive\",\"false\");if(session){session.mute({audio:true});}}else{target.style.opacity=\"1\";target.setAttribute(\"isactive\",\"true\");if(session){session.unmute({audio:true});}}}function hideCallingContainer(){var callingContainer=document.getElementById(\"calling-container\");callingContainer.style.animation=\"hide  1.5s forwards\";callingContainer.addEventListener(\"animationend\",function(){callingContainer.style.animation=\"\";callingContainer.style.display=\"none\";callingContainer.style.opacity=\"0\";});}function showCallingContainer(){var deleteButton=document.getElementById(\"delete-button\");var callingContainer=document.getElementById(\"calling-container\");callingContainer.style.display=\"flex\";callingContainer.style.animation=\"show  1.5s forwards\";callingContainer.addEventListener(\"animationend\",function(){callingContainer.style.animation=\"\";callingContainer.style.display=\"flex\";callingContainer.style.opacity=\"1\";});deleteButton.style.opacity=\"0\";deleteButton.style.pointerEvents=\"none\";hideNumpad();var callButton=document.getElementById(\"call-button\");callButton.src=endIcon;}function hideNumpad(){var numpad=document.getElementById(\"numpad\");numpad.style.animation=\"hide  1.5s forwards\";numpad.addEventListener(\"animationend\",function(){numpad.style.animation=\"\";numpad.style.display=\"none\";numpad.style.opacity=\"0\";});}function showNumpad(){var deleteButton=document.getElementById(\"delete-button\");var numpad=document.getElementById(\"numpad\");numpad.style.display=\"flex\";numpad.style.animation=\"show  1.5s forwards\";numpad.addEventListener(\"animationend\",function(){numpad.style.animation=\"\";numpad.style.display=\"flex\";numpad.style.opacity=\"1\";});deleteButton.style.opacity=\"1\";deleteButton.style.pointerEvents=\"auto\";hideCallingContainer();var callButton=document.getElementById(\"call-button\");callButton.src=callIcon;}var getDevice=function getDevice(){var device=\"Unknown\";var ua={\"Generic Linux\":/Linux/i,Android:/Android/i,BlackBerry:/BlackBerry/i,Bluebird:/EF500/i,\"Chrome OS\":/CrOS/i,Datalogic:/DL-AXIS/i,Honeywell:/CT50/i,iPad:/iPad/i,iPhone:/iPhone/i,iPod:/iPod/i,macOS:/Macintosh/i,Windows:/IEMobile|Windows/i,Zebra:/TC70|TC55/i};Object.keys(ua).map(function(v){return navigator.userAgent.match(ua[v])&&(device=v);});return device.charAt(0).toUpperCase()+device.slice(1);};function App(){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),phoneNumber=_useState2[0],setPhoneNumber=_useState2[1];function call(e){var target=e.target;if(target===e.currentTarget){target.style.animation=\"fade 0.5s forwards\";target.addEventListener(\"animationend\",function(){target.style.animation=\"\";});if(phoneNumber!=\"\"){startCallAudio(phoneNumber);setCallButton();}}}function click(e){var target=e.target;if(target===e.currentTarget){target.style.animation=\"fade 0.5s forwards\";target.addEventListener(\"animationend\",function(){target.style.animation=\"\";});setPhoneNumber(phoneNumber+target.attributes.getNamedItem(\"value\").value);}}function deleteNum(e){setPhoneNumber(phoneNumber.slice(0,-1));}return/*#__PURE__*/_jsx(\"div\",{className:\"App\",children:/*#__PURE__*/_jsx(\"div\",{id:\"phone\",children:/*#__PURE__*/_jsxs(\"div\",{id:\"wrapper\",children:[/*#__PURE__*/_jsx(\"p\",{id:\"phone-number\",number:\"\",children:phoneNumber}),/*#__PURE__*/_jsxs(\"div\",{id:\"function-container\",children:[/*#__PURE__*/_jsxs(\"div\",{id:\"numpad\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"button-container\",children:[/*#__PURE__*/_jsxs(\"div\",{onClick:click,className:\"key\",value:\"1\",children:[\"1\",/*#__PURE__*/_jsx(\"span\",{children:\"\\xA0\"})]}),/*#__PURE__*/_jsxs(\"div\",{onClick:click,className:\"key\",value:\"2\",children:[\"2\",/*#__PURE__*/_jsx(\"span\",{children:\"abc\"})]}),/*#__PURE__*/_jsxs(\"div\",{onClick:click,className:\"key\",value:\"3\",children:[\"3\",/*#__PURE__*/_jsx(\"span\",{children:\"def\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"button-container\",children:[/*#__PURE__*/_jsxs(\"div\",{onClick:click,className:\"key\",value:\"4\",children:[\"4\",/*#__PURE__*/_jsx(\"span\",{children:\"ghi\"})]}),/*#__PURE__*/_jsxs(\"div\",{onClick:click,className:\"key\",value:\"5\",children:[\"5\",/*#__PURE__*/_jsx(\"span\",{children:\"jkl\"})]}),/*#__PURE__*/_jsxs(\"div\",{onClick:click,className:\"key\",value:\"6\",children:[\"6\",/*#__PURE__*/_jsx(\"span\",{children:\"mno\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"button-container\",children:[/*#__PURE__*/_jsxs(\"div\",{onClick:click,className:\"key\",value:\"7\",children:[\"7\",/*#__PURE__*/_jsx(\"span\",{children:\"pqrs\"})]}),/*#__PURE__*/_jsxs(\"div\",{onClick:click,className:\"key\",value:\"8\",children:[\"8\",/*#__PURE__*/_jsx(\"span\",{children:\"tuv\"})]}),/*#__PURE__*/_jsxs(\"div\",{onClick:click,className:\"key\",value:\"9\",children:[\"9\",/*#__PURE__*/_jsx(\"span\",{children:\"wxyz\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"button-container\",children:[/*#__PURE__*/_jsx(\"div\",{onClick:click,id:\"special-button-left\",className:\"key special\",value:\"*\",children:\"*\"}),/*#__PURE__*/_jsxs(\"div\",{onClick:click,className:\"key\",value:\"0\",children:[\"0\",/*#__PURE__*/_jsx(\"span\",{children:\"+\"})]}),/*#__PURE__*/_jsx(\"div\",{onClick:click,id:\"special-button-right\",className:\"key special\",value:\"#\",children:\"#\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{id:\"calling-container\",children:[/*#__PURE__*/_jsx(\"p\",{id:\"status-text\",style:{fontWeight:\"bold\"},children:\"Ringing\"}),/*#__PURE__*/_jsx(\"p\",{id:\"device-text\",style:{margin:\"3px\"},children:getDevice()}),/*#__PURE__*/_jsx(\"p\",{id:\"ip-text\",style:{margin:\"3px\"},children:internetProtocol}),/*#__PURE__*/_jsx(\"p\",{id:\"location-text\",style:{margin:\"3px\"},children:address}),/*#__PURE__*/_jsxs(\"div\",{className:\"button-container\",children:[/*#__PURE__*/_jsx(\"img\",{id:\"mute-button\",onClick:onMute,isactive:\"true\",src:muteIcon,alt:\"\"}),/*#__PURE__*/_jsx(\"img\",{id:\"audio-button\",onClick:onAudio,isactive:\"true\",src:audioIcon,alt:\"\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"button-container\",children:[/*#__PURE__*/_jsx(\"div\",{style:{width:\"75px\",height:\"75px\"}}),/*#__PURE__*/_jsx(\"img\",{id:\"call-button\",iscalling:\"false\",onClick:call,style:{width:\"65px\",height:\"65px\",margin:\"10px\",padding:0},src:callIcon,alt:\"\"}),/*#__PURE__*/_jsx(\"img\",{id:\"delete-button\",onClick:deleteNum,style:{width:\"25px\",margin:\"13px\",paddingLeft:\"20px\"},src:deleteIcon,alt:\"\"})]})]})})});}export default App;","map":null,"metadata":{},"sourceType":"module"}