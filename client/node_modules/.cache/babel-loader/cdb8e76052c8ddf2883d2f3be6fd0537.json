{"ast":null,"code":"\"use strict\";\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nvar EventEmitter = require('events').EventEmitter;\n\nvar Logger = require('./Logger');\n\nvar JsSIP_C = require('./Constants');\n\nvar SIPMessage = require('./SIPMessage');\n\nvar Timers = require('./Timers');\n\nvar loggernict = new Logger('NonInviteClientTransaction');\nvar loggerict = new Logger('InviteClientTransaction');\nvar loggeract = new Logger('AckClientTransaction');\nvar loggernist = new Logger('NonInviteServerTransaction');\nvar loggerist = new Logger('InviteServerTransaction');\nvar C = {\n  // Transaction states.\n  STATUS_TRYING: 1,\n  STATUS_PROCEEDING: 2,\n  STATUS_CALLING: 3,\n  STATUS_ACCEPTED: 4,\n  STATUS_COMPLETED: 5,\n  STATUS_TERMINATED: 6,\n  STATUS_CONFIRMED: 7,\n  // Transaction types.\n  NON_INVITE_CLIENT: 'nict',\n  NON_INVITE_SERVER: 'nist',\n  INVITE_CLIENT: 'ict',\n  INVITE_SERVER: 'ist'\n};\n\nvar NonInviteClientTransaction = /*#__PURE__*/function (_EventEmitter) {\n  _inherits(NonInviteClientTransaction, _EventEmitter);\n\n  var _super = _createSuper(NonInviteClientTransaction);\n\n  function NonInviteClientTransaction(ua, transport, request, eventHandlers) {\n    var _this;\n\n    _classCallCheck(this, NonInviteClientTransaction);\n\n    _this = _super.call(this);\n    _this.type = C.NON_INVITE_CLIENT;\n    _this.id = \"z9hG4bK\".concat(Math.floor(Math.random() * 10000000));\n    _this.ua = ua;\n    _this.transport = transport;\n    _this.request = request;\n    _this.eventHandlers = eventHandlers;\n    var via = \"SIP/2.0/\".concat(transport.via_transport);\n    via += \" \".concat(ua.configuration.via_host, \";branch=\").concat(_this.id);\n\n    _this.request.setHeader('via', via);\n\n    _this.ua.newTransaction(_assertThisInitialized(_this));\n\n    return _this;\n  }\n\n  _createClass(NonInviteClientTransaction, [{\n    key: \"stateChanged\",\n    value: function stateChanged(state) {\n      this.state = state;\n      this.emit('stateChanged');\n    }\n  }, {\n    key: \"send\",\n    value: function send() {\n      var _this2 = this;\n\n      this.stateChanged(C.STATUS_TRYING);\n      this.F = setTimeout(function () {\n        _this2.timer_F();\n      }, Timers.TIMER_F);\n\n      if (!this.transport.send(this.request)) {\n        this.onTransportError();\n      }\n    }\n  }, {\n    key: \"onTransportError\",\n    value: function onTransportError() {\n      loggernict.debug(\"transport error occurred, deleting transaction \".concat(this.id));\n      clearTimeout(this.F);\n      clearTimeout(this.K);\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n      this.eventHandlers.onTransportError();\n    }\n  }, {\n    key: \"timer_F\",\n    value: function timer_F() {\n      loggernict.debug(\"Timer F expired for transaction \".concat(this.id));\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n      this.eventHandlers.onRequestTimeout();\n    }\n  }, {\n    key: \"timer_K\",\n    value: function timer_K() {\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n    }\n  }, {\n    key: \"receiveResponse\",\n    value: function receiveResponse(response) {\n      var _this3 = this;\n\n      var status_code = response.status_code;\n\n      if (status_code < 200) {\n        switch (this.state) {\n          case C.STATUS_TRYING:\n          case C.STATUS_PROCEEDING:\n            this.stateChanged(C.STATUS_PROCEEDING);\n            this.eventHandlers.onReceiveResponse(response);\n            break;\n        }\n      } else {\n        switch (this.state) {\n          case C.STATUS_TRYING:\n          case C.STATUS_PROCEEDING:\n            this.stateChanged(C.STATUS_COMPLETED);\n            clearTimeout(this.F);\n\n            if (status_code === 408) {\n              this.eventHandlers.onRequestTimeout();\n            } else {\n              this.eventHandlers.onReceiveResponse(response);\n            }\n\n            this.K = setTimeout(function () {\n              _this3.timer_K();\n            }, Timers.TIMER_K);\n            break;\n\n          case C.STATUS_COMPLETED:\n            break;\n        }\n      }\n    }\n  }, {\n    key: \"C\",\n    get: function get() {\n      return C;\n    }\n  }]);\n\n  return NonInviteClientTransaction;\n}(EventEmitter);\n\nvar InviteClientTransaction = /*#__PURE__*/function (_EventEmitter2) {\n  _inherits(InviteClientTransaction, _EventEmitter2);\n\n  var _super2 = _createSuper(InviteClientTransaction);\n\n  function InviteClientTransaction(ua, transport, request, eventHandlers) {\n    var _this4;\n\n    _classCallCheck(this, InviteClientTransaction);\n\n    _this4 = _super2.call(this);\n    _this4.type = C.INVITE_CLIENT;\n    _this4.id = \"z9hG4bK\".concat(Math.floor(Math.random() * 10000000));\n    _this4.ua = ua;\n    _this4.transport = transport;\n    _this4.request = request;\n    _this4.eventHandlers = eventHandlers;\n    request.transaction = _assertThisInitialized(_this4);\n    var via = \"SIP/2.0/\".concat(transport.via_transport);\n    via += \" \".concat(ua.configuration.via_host, \";branch=\").concat(_this4.id);\n\n    _this4.request.setHeader('via', via);\n\n    _this4.ua.newTransaction(_assertThisInitialized(_this4));\n\n    return _this4;\n  }\n\n  _createClass(InviteClientTransaction, [{\n    key: \"stateChanged\",\n    value: function stateChanged(state) {\n      this.state = state;\n      this.emit('stateChanged');\n    }\n  }, {\n    key: \"send\",\n    value: function send() {\n      var _this5 = this;\n\n      this.stateChanged(C.STATUS_CALLING);\n      this.B = setTimeout(function () {\n        _this5.timer_B();\n      }, Timers.TIMER_B);\n\n      if (!this.transport.send(this.request)) {\n        this.onTransportError();\n      }\n    }\n  }, {\n    key: \"onTransportError\",\n    value: function onTransportError() {\n      clearTimeout(this.B);\n      clearTimeout(this.D);\n      clearTimeout(this.M);\n\n      if (this.state !== C.STATUS_ACCEPTED) {\n        loggerict.debug(\"transport error occurred, deleting transaction \".concat(this.id));\n        this.eventHandlers.onTransportError();\n      }\n\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n    } // RFC 6026 7.2.\n\n  }, {\n    key: \"timer_M\",\n    value: function timer_M() {\n      loggerict.debug(\"Timer M expired for transaction \".concat(this.id));\n\n      if (this.state === C.STATUS_ACCEPTED) {\n        clearTimeout(this.B);\n        this.stateChanged(C.STATUS_TERMINATED);\n        this.ua.destroyTransaction(this);\n      }\n    } // RFC 3261 17.1.1.\n\n  }, {\n    key: \"timer_B\",\n    value: function timer_B() {\n      loggerict.debug(\"Timer B expired for transaction \".concat(this.id));\n\n      if (this.state === C.STATUS_CALLING) {\n        this.stateChanged(C.STATUS_TERMINATED);\n        this.ua.destroyTransaction(this);\n        this.eventHandlers.onRequestTimeout();\n      }\n    }\n  }, {\n    key: \"timer_D\",\n    value: function timer_D() {\n      loggerict.debug(\"Timer D expired for transaction \".concat(this.id));\n      clearTimeout(this.B);\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n    }\n  }, {\n    key: \"sendACK\",\n    value: function sendACK(response) {\n      var _this6 = this;\n\n      var ack = new SIPMessage.OutgoingRequest(JsSIP_C.ACK, this.request.ruri, this.ua, {\n        'route_set': this.request.getHeaders('route'),\n        'call_id': this.request.getHeader('call-id'),\n        'cseq': this.request.cseq\n      });\n      ack.setHeader('from', this.request.getHeader('from'));\n      ack.setHeader('via', this.request.getHeader('via'));\n      ack.setHeader('to', response.getHeader('to'));\n      this.D = setTimeout(function () {\n        _this6.timer_D();\n      }, Timers.TIMER_D);\n      this.transport.send(ack);\n    }\n  }, {\n    key: \"cancel\",\n    value: function cancel(reason) {\n      // Send only if a provisional response (>100) has been received.\n      if (this.state !== C.STATUS_PROCEEDING) {\n        return;\n      }\n\n      var cancel = new SIPMessage.OutgoingRequest(JsSIP_C.CANCEL, this.request.ruri, this.ua, {\n        'route_set': this.request.getHeaders('route'),\n        'call_id': this.request.getHeader('call-id'),\n        'cseq': this.request.cseq\n      });\n      cancel.setHeader('from', this.request.getHeader('from'));\n      cancel.setHeader('via', this.request.getHeader('via'));\n      cancel.setHeader('to', this.request.getHeader('to'));\n\n      if (reason) {\n        cancel.setHeader('reason', reason);\n      }\n\n      this.transport.send(cancel);\n    }\n  }, {\n    key: \"receiveResponse\",\n    value: function receiveResponse(response) {\n      var _this7 = this;\n\n      var status_code = response.status_code;\n\n      if (status_code >= 100 && status_code <= 199) {\n        switch (this.state) {\n          case C.STATUS_CALLING:\n            this.stateChanged(C.STATUS_PROCEEDING);\n            this.eventHandlers.onReceiveResponse(response);\n            break;\n\n          case C.STATUS_PROCEEDING:\n            this.eventHandlers.onReceiveResponse(response);\n            break;\n        }\n      } else if (status_code >= 200 && status_code <= 299) {\n        switch (this.state) {\n          case C.STATUS_CALLING:\n          case C.STATUS_PROCEEDING:\n            this.stateChanged(C.STATUS_ACCEPTED);\n            this.M = setTimeout(function () {\n              _this7.timer_M();\n            }, Timers.TIMER_M);\n            this.eventHandlers.onReceiveResponse(response);\n            break;\n\n          case C.STATUS_ACCEPTED:\n            this.eventHandlers.onReceiveResponse(response);\n            break;\n        }\n      } else if (status_code >= 300 && status_code <= 699) {\n        switch (this.state) {\n          case C.STATUS_CALLING:\n          case C.STATUS_PROCEEDING:\n            this.stateChanged(C.STATUS_COMPLETED);\n            this.sendACK(response);\n            this.eventHandlers.onReceiveResponse(response);\n            break;\n\n          case C.STATUS_COMPLETED:\n            this.sendACK(response);\n            break;\n        }\n      }\n    }\n  }, {\n    key: \"C\",\n    get: function get() {\n      return C;\n    }\n  }]);\n\n  return InviteClientTransaction;\n}(EventEmitter);\n\nvar AckClientTransaction = /*#__PURE__*/function (_EventEmitter3) {\n  _inherits(AckClientTransaction, _EventEmitter3);\n\n  var _super3 = _createSuper(AckClientTransaction);\n\n  function AckClientTransaction(ua, transport, request, eventHandlers) {\n    var _this8;\n\n    _classCallCheck(this, AckClientTransaction);\n\n    _this8 = _super3.call(this);\n    _this8.id = \"z9hG4bK\".concat(Math.floor(Math.random() * 10000000));\n    _this8.transport = transport;\n    _this8.request = request;\n    _this8.eventHandlers = eventHandlers;\n    var via = \"SIP/2.0/\".concat(transport.via_transport);\n    via += \" \".concat(ua.configuration.via_host, \";branch=\").concat(_this8.id);\n\n    _this8.request.setHeader('via', via);\n\n    return _this8;\n  }\n\n  _createClass(AckClientTransaction, [{\n    key: \"send\",\n    value: function send() {\n      if (!this.transport.send(this.request)) {\n        this.onTransportError();\n      }\n    }\n  }, {\n    key: \"onTransportError\",\n    value: function onTransportError() {\n      loggeract.debug(\"transport error occurred for transaction \".concat(this.id));\n      this.eventHandlers.onTransportError();\n    }\n  }, {\n    key: \"C\",\n    get: function get() {\n      return C;\n    }\n  }]);\n\n  return AckClientTransaction;\n}(EventEmitter);\n\nvar NonInviteServerTransaction = /*#__PURE__*/function (_EventEmitter4) {\n  _inherits(NonInviteServerTransaction, _EventEmitter4);\n\n  var _super4 = _createSuper(NonInviteServerTransaction);\n\n  function NonInviteServerTransaction(ua, transport, request) {\n    var _this9;\n\n    _classCallCheck(this, NonInviteServerTransaction);\n\n    _this9 = _super4.call(this);\n    _this9.type = C.NON_INVITE_SERVER;\n    _this9.id = request.via_branch;\n    _this9.ua = ua;\n    _this9.transport = transport;\n    _this9.request = request;\n    _this9.last_response = '';\n    request.server_transaction = _assertThisInitialized(_this9);\n    _this9.state = C.STATUS_TRYING;\n    ua.newTransaction(_assertThisInitialized(_this9));\n    return _this9;\n  }\n\n  _createClass(NonInviteServerTransaction, [{\n    key: \"stateChanged\",\n    value: function stateChanged(state) {\n      this.state = state;\n      this.emit('stateChanged');\n    }\n  }, {\n    key: \"timer_J\",\n    value: function timer_J() {\n      loggernist.debug(\"Timer J expired for transaction \".concat(this.id));\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n    }\n  }, {\n    key: \"onTransportError\",\n    value: function onTransportError() {\n      if (!this.transportError) {\n        this.transportError = true;\n        loggernist.debug(\"transport error occurred, deleting transaction \".concat(this.id));\n        clearTimeout(this.J);\n        this.stateChanged(C.STATUS_TERMINATED);\n        this.ua.destroyTransaction(this);\n      }\n    }\n  }, {\n    key: \"receiveResponse\",\n    value: function receiveResponse(status_code, response, onSuccess, onFailure) {\n      var _this10 = this;\n\n      if (status_code === 100) {\n        /* RFC 4320 4.1\n         * 'A SIP element MUST NOT\n         * send any provisional response with a\n         * Status-Code other than 100 to a non-INVITE request.'\n         */\n        switch (this.state) {\n          case C.STATUS_TRYING:\n            this.stateChanged(C.STATUS_PROCEEDING);\n\n            if (!this.transport.send(response)) {\n              this.onTransportError();\n            }\n\n            break;\n\n          case C.STATUS_PROCEEDING:\n            this.last_response = response;\n\n            if (!this.transport.send(response)) {\n              this.onTransportError();\n\n              if (onFailure) {\n                onFailure();\n              }\n            } else if (onSuccess) {\n              onSuccess();\n            }\n\n            break;\n        }\n      } else if (status_code >= 200 && status_code <= 699) {\n        switch (this.state) {\n          case C.STATUS_TRYING:\n          case C.STATUS_PROCEEDING:\n            this.stateChanged(C.STATUS_COMPLETED);\n            this.last_response = response;\n            this.J = setTimeout(function () {\n              _this10.timer_J();\n            }, Timers.TIMER_J);\n\n            if (!this.transport.send(response)) {\n              this.onTransportError();\n\n              if (onFailure) {\n                onFailure();\n              }\n            } else if (onSuccess) {\n              onSuccess();\n            }\n\n            break;\n\n          case C.STATUS_COMPLETED:\n            break;\n        }\n      }\n    }\n  }, {\n    key: \"C\",\n    get: function get() {\n      return C;\n    }\n  }]);\n\n  return NonInviteServerTransaction;\n}(EventEmitter);\n\nvar InviteServerTransaction = /*#__PURE__*/function (_EventEmitter5) {\n  _inherits(InviteServerTransaction, _EventEmitter5);\n\n  var _super5 = _createSuper(InviteServerTransaction);\n\n  function InviteServerTransaction(ua, transport, request) {\n    var _this11;\n\n    _classCallCheck(this, InviteServerTransaction);\n\n    _this11 = _super5.call(this);\n    _this11.type = C.INVITE_SERVER;\n    _this11.id = request.via_branch;\n    _this11.ua = ua;\n    _this11.transport = transport;\n    _this11.request = request;\n    _this11.last_response = '';\n    request.server_transaction = _assertThisInitialized(_this11);\n    _this11.state = C.STATUS_PROCEEDING;\n    ua.newTransaction(_assertThisInitialized(_this11));\n    _this11.resendProvisionalTimer = null;\n    request.reply(100);\n    return _this11;\n  }\n\n  _createClass(InviteServerTransaction, [{\n    key: \"stateChanged\",\n    value: function stateChanged(state) {\n      this.state = state;\n      this.emit('stateChanged');\n    }\n  }, {\n    key: \"timer_H\",\n    value: function timer_H() {\n      loggerist.debug(\"Timer H expired for transaction \".concat(this.id));\n\n      if (this.state === C.STATUS_COMPLETED) {\n        loggerist.debug('ACK not received, dialog will be terminated');\n      }\n\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n    }\n  }, {\n    key: \"timer_I\",\n    value: function timer_I() {\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n    } // RFC 6026 7.1.\n\n  }, {\n    key: \"timer_L\",\n    value: function timer_L() {\n      loggerist.debug(\"Timer L expired for transaction \".concat(this.id));\n\n      if (this.state === C.STATUS_ACCEPTED) {\n        this.stateChanged(C.STATUS_TERMINATED);\n        this.ua.destroyTransaction(this);\n      }\n    }\n  }, {\n    key: \"onTransportError\",\n    value: function onTransportError() {\n      if (!this.transportError) {\n        this.transportError = true;\n        loggerist.debug(\"transport error occurred, deleting transaction \".concat(this.id));\n\n        if (this.resendProvisionalTimer !== null) {\n          clearInterval(this.resendProvisionalTimer);\n          this.resendProvisionalTimer = null;\n        }\n\n        clearTimeout(this.L);\n        clearTimeout(this.H);\n        clearTimeout(this.I);\n        this.stateChanged(C.STATUS_TERMINATED);\n        this.ua.destroyTransaction(this);\n      }\n    }\n  }, {\n    key: \"resend_provisional\",\n    value: function resend_provisional() {\n      if (!this.transport.send(this.last_response)) {\n        this.onTransportError();\n      }\n    } // INVITE Server Transaction RFC 3261 17.2.1.\n\n  }, {\n    key: \"receiveResponse\",\n    value: function receiveResponse(status_code, response, onSuccess, onFailure) {\n      var _this12 = this;\n\n      if (status_code >= 100 && status_code <= 199) {\n        switch (this.state) {\n          case C.STATUS_PROCEEDING:\n            if (!this.transport.send(response)) {\n              this.onTransportError();\n            }\n\n            this.last_response = response;\n            break;\n        }\n      }\n\n      if (status_code > 100 && status_code <= 199 && this.state === C.STATUS_PROCEEDING) {\n        // Trigger the resendProvisionalTimer only for the first non 100 provisional response.\n        if (this.resendProvisionalTimer === null) {\n          this.resendProvisionalTimer = setInterval(function () {\n            _this12.resend_provisional();\n          }, Timers.PROVISIONAL_RESPONSE_INTERVAL);\n        }\n      } else if (status_code >= 200 && status_code <= 299) {\n        switch (this.state) {\n          case C.STATUS_PROCEEDING:\n            this.stateChanged(C.STATUS_ACCEPTED);\n            this.last_response = response;\n            this.L = setTimeout(function () {\n              _this12.timer_L();\n            }, Timers.TIMER_L);\n\n            if (this.resendProvisionalTimer !== null) {\n              clearInterval(this.resendProvisionalTimer);\n              this.resendProvisionalTimer = null;\n            }\n\n          /* falls through */\n\n          case C.STATUS_ACCEPTED:\n            // Note that this point will be reached for proceeding this.state also.\n            if (!this.transport.send(response)) {\n              this.onTransportError();\n\n              if (onFailure) {\n                onFailure();\n              }\n            } else if (onSuccess) {\n              onSuccess();\n            }\n\n            break;\n        }\n      } else if (status_code >= 300 && status_code <= 699) {\n        switch (this.state) {\n          case C.STATUS_PROCEEDING:\n            if (this.resendProvisionalTimer !== null) {\n              clearInterval(this.resendProvisionalTimer);\n              this.resendProvisionalTimer = null;\n            }\n\n            if (!this.transport.send(response)) {\n              this.onTransportError();\n\n              if (onFailure) {\n                onFailure();\n              }\n            } else {\n              this.stateChanged(C.STATUS_COMPLETED);\n              this.H = setTimeout(function () {\n                _this12.timer_H();\n              }, Timers.TIMER_H);\n\n              if (onSuccess) {\n                onSuccess();\n              }\n            }\n\n            break;\n        }\n      }\n    }\n  }, {\n    key: \"C\",\n    get: function get() {\n      return C;\n    }\n  }]);\n\n  return InviteServerTransaction;\n}(EventEmitter);\n/**\n * INVITE:\n *  _true_ if retransmission\n *  _false_ new request\n *\n * ACK:\n *  _true_  ACK to non2xx response\n *  _false_ ACK must be passed to TU (accepted state)\n *          ACK to 2xx response\n *\n * CANCEL:\n *  _true_  no matching invite transaction\n *  _false_ matching invite transaction and no final response sent\n *\n * OTHER:\n *  _true_  retransmission\n *  _false_ new request\n */\n\n\nfunction checkTransaction(_ref, request) {\n  var _transactions = _ref._transactions;\n  var tr;\n\n  switch (request.method) {\n    case JsSIP_C.INVITE:\n      tr = _transactions.ist[request.via_branch];\n\n      if (tr) {\n        switch (tr.state) {\n          case C.STATUS_PROCEEDING:\n            tr.transport.send(tr.last_response);\n            break;\n          // RFC 6026 7.1 Invite retransmission.\n          // Received while in C.STATUS_ACCEPTED state. Absorb it.\n\n          case C.STATUS_ACCEPTED:\n            break;\n        }\n\n        return true;\n      }\n\n      break;\n\n    case JsSIP_C.ACK:\n      tr = _transactions.ist[request.via_branch]; // RFC 6026 7.1.\n\n      if (tr) {\n        if (tr.state === C.STATUS_ACCEPTED) {\n          return false;\n        } else if (tr.state === C.STATUS_COMPLETED) {\n          tr.state = C.STATUS_CONFIRMED;\n          tr.I = setTimeout(function () {\n            tr.timer_I();\n          }, Timers.TIMER_I);\n          return true;\n        }\n      } // ACK to 2XX Response.\n      else {\n          return false;\n        }\n\n      break;\n\n    case JsSIP_C.CANCEL:\n      tr = _transactions.ist[request.via_branch];\n\n      if (tr) {\n        request.reply_sl(200);\n\n        if (tr.state === C.STATUS_PROCEEDING) {\n          return false;\n        } else {\n          return true;\n        }\n      } else {\n        request.reply_sl(481);\n        return true;\n      }\n\n    default:\n      // Non-INVITE Server Transaction RFC 3261 17.2.2.\n      tr = _transactions.nist[request.via_branch];\n\n      if (tr) {\n        switch (tr.state) {\n          case C.STATUS_TRYING:\n            break;\n\n          case C.STATUS_PROCEEDING:\n          case C.STATUS_COMPLETED:\n            tr.transport.send(tr.last_response);\n            break;\n        }\n\n        return true;\n      }\n\n      break;\n  }\n}\n\nmodule.exports = {\n  C: C,\n  NonInviteClientTransaction: NonInviteClientTransaction,\n  InviteClientTransaction: InviteClientTransaction,\n  AckClientTransaction: AckClientTransaction,\n  NonInviteServerTransaction: NonInviteServerTransaction,\n  InviteServerTransaction: InviteServerTransaction,\n  checkTransaction: checkTransaction\n};","map":{"version":3,"sources":["/Users/tuphan/Desktop/gcallstest/node_modules/jssip/lib-es5/Transactions.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","_inherits","subClass","superClass","create","value","_setPrototypeOf","o","p","setPrototypeOf","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf","result","NewTarget","Reflect","construct","arguments","apply","_possibleConstructorReturn","self","call","_assertThisInitialized","ReferenceError","sham","Proxy","Date","toString","e","getPrototypeOf","EventEmitter","require","Logger","JsSIP_C","SIPMessage","Timers","loggernict","loggerict","loggeract","loggernist","loggerist","C","STATUS_TRYING","STATUS_PROCEEDING","STATUS_CALLING","STATUS_ACCEPTED","STATUS_COMPLETED","STATUS_TERMINATED","STATUS_CONFIRMED","NON_INVITE_CLIENT","NON_INVITE_SERVER","INVITE_CLIENT","INVITE_SERVER","NonInviteClientTransaction","_EventEmitter","_super","ua","transport","request","eventHandlers","_this","type","id","concat","Math","floor","random","via","via_transport","configuration","via_host","setHeader","newTransaction","stateChanged","state","emit","send","_this2","F","setTimeout","timer_F","TIMER_F","onTransportError","debug","clearTimeout","K","destroyTransaction","onRequestTimeout","timer_K","receiveResponse","response","_this3","status_code","onReceiveResponse","TIMER_K","get","InviteClientTransaction","_EventEmitter2","_super2","_this4","transaction","_this5","B","timer_B","TIMER_B","D","M","timer_M","timer_D","sendACK","_this6","ack","OutgoingRequest","ACK","ruri","getHeaders","getHeader","cseq","TIMER_D","cancel","reason","CANCEL","_this7","TIMER_M","AckClientTransaction","_EventEmitter3","_super3","_this8","NonInviteServerTransaction","_EventEmitter4","_super4","_this9","via_branch","last_response","server_transaction","timer_J","transportError","J","onSuccess","onFailure","_this10","TIMER_J","InviteServerTransaction","_EventEmitter5","_super5","_this11","resendProvisionalTimer","reply","timer_H","timer_I","timer_L","clearInterval","L","H","I","resend_provisional","_this12","setInterval","PROVISIONAL_RESPONSE_INTERVAL","TIMER_L","TIMER_H","checkTransaction","_ref","_transactions","tr","method","INVITE","ist","TIMER_I","reply_sl","nist","module","exports"],"mappings":"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","sourcesContent":["\"use strict\";\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nvar EventEmitter = require('events').EventEmitter;\n\nvar Logger = require('./Logger');\n\nvar JsSIP_C = require('./Constants');\n\nvar SIPMessage = require('./SIPMessage');\n\nvar Timers = require('./Timers');\n\nvar loggernict = new Logger('NonInviteClientTransaction');\nvar loggerict = new Logger('InviteClientTransaction');\nvar loggeract = new Logger('AckClientTransaction');\nvar loggernist = new Logger('NonInviteServerTransaction');\nvar loggerist = new Logger('InviteServerTransaction');\nvar C = {\n  // Transaction states.\n  STATUS_TRYING: 1,\n  STATUS_PROCEEDING: 2,\n  STATUS_CALLING: 3,\n  STATUS_ACCEPTED: 4,\n  STATUS_COMPLETED: 5,\n  STATUS_TERMINATED: 6,\n  STATUS_CONFIRMED: 7,\n  // Transaction types.\n  NON_INVITE_CLIENT: 'nict',\n  NON_INVITE_SERVER: 'nist',\n  INVITE_CLIENT: 'ict',\n  INVITE_SERVER: 'ist'\n};\n\nvar NonInviteClientTransaction = /*#__PURE__*/function (_EventEmitter) {\n  _inherits(NonInviteClientTransaction, _EventEmitter);\n\n  var _super = _createSuper(NonInviteClientTransaction);\n\n  function NonInviteClientTransaction(ua, transport, request, eventHandlers) {\n    var _this;\n\n    _classCallCheck(this, NonInviteClientTransaction);\n\n    _this = _super.call(this);\n    _this.type = C.NON_INVITE_CLIENT;\n    _this.id = \"z9hG4bK\".concat(Math.floor(Math.random() * 10000000));\n    _this.ua = ua;\n    _this.transport = transport;\n    _this.request = request;\n    _this.eventHandlers = eventHandlers;\n    var via = \"SIP/2.0/\".concat(transport.via_transport);\n    via += \" \".concat(ua.configuration.via_host, \";branch=\").concat(_this.id);\n\n    _this.request.setHeader('via', via);\n\n    _this.ua.newTransaction(_assertThisInitialized(_this));\n\n    return _this;\n  }\n\n  _createClass(NonInviteClientTransaction, [{\n    key: \"stateChanged\",\n    value: function stateChanged(state) {\n      this.state = state;\n      this.emit('stateChanged');\n    }\n  }, {\n    key: \"send\",\n    value: function send() {\n      var _this2 = this;\n\n      this.stateChanged(C.STATUS_TRYING);\n      this.F = setTimeout(function () {\n        _this2.timer_F();\n      }, Timers.TIMER_F);\n\n      if (!this.transport.send(this.request)) {\n        this.onTransportError();\n      }\n    }\n  }, {\n    key: \"onTransportError\",\n    value: function onTransportError() {\n      loggernict.debug(\"transport error occurred, deleting transaction \".concat(this.id));\n      clearTimeout(this.F);\n      clearTimeout(this.K);\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n      this.eventHandlers.onTransportError();\n    }\n  }, {\n    key: \"timer_F\",\n    value: function timer_F() {\n      loggernict.debug(\"Timer F expired for transaction \".concat(this.id));\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n      this.eventHandlers.onRequestTimeout();\n    }\n  }, {\n    key: \"timer_K\",\n    value: function timer_K() {\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n    }\n  }, {\n    key: \"receiveResponse\",\n    value: function receiveResponse(response) {\n      var _this3 = this;\n\n      var status_code = response.status_code;\n\n      if (status_code < 200) {\n        switch (this.state) {\n          case C.STATUS_TRYING:\n          case C.STATUS_PROCEEDING:\n            this.stateChanged(C.STATUS_PROCEEDING);\n            this.eventHandlers.onReceiveResponse(response);\n            break;\n        }\n      } else {\n        switch (this.state) {\n          case C.STATUS_TRYING:\n          case C.STATUS_PROCEEDING:\n            this.stateChanged(C.STATUS_COMPLETED);\n            clearTimeout(this.F);\n\n            if (status_code === 408) {\n              this.eventHandlers.onRequestTimeout();\n            } else {\n              this.eventHandlers.onReceiveResponse(response);\n            }\n\n            this.K = setTimeout(function () {\n              _this3.timer_K();\n            }, Timers.TIMER_K);\n            break;\n\n          case C.STATUS_COMPLETED:\n            break;\n        }\n      }\n    }\n  }, {\n    key: \"C\",\n    get: function get() {\n      return C;\n    }\n  }]);\n\n  return NonInviteClientTransaction;\n}(EventEmitter);\n\nvar InviteClientTransaction = /*#__PURE__*/function (_EventEmitter2) {\n  _inherits(InviteClientTransaction, _EventEmitter2);\n\n  var _super2 = _createSuper(InviteClientTransaction);\n\n  function InviteClientTransaction(ua, transport, request, eventHandlers) {\n    var _this4;\n\n    _classCallCheck(this, InviteClientTransaction);\n\n    _this4 = _super2.call(this);\n    _this4.type = C.INVITE_CLIENT;\n    _this4.id = \"z9hG4bK\".concat(Math.floor(Math.random() * 10000000));\n    _this4.ua = ua;\n    _this4.transport = transport;\n    _this4.request = request;\n    _this4.eventHandlers = eventHandlers;\n    request.transaction = _assertThisInitialized(_this4);\n    var via = \"SIP/2.0/\".concat(transport.via_transport);\n    via += \" \".concat(ua.configuration.via_host, \";branch=\").concat(_this4.id);\n\n    _this4.request.setHeader('via', via);\n\n    _this4.ua.newTransaction(_assertThisInitialized(_this4));\n\n    return _this4;\n  }\n\n  _createClass(InviteClientTransaction, [{\n    key: \"stateChanged\",\n    value: function stateChanged(state) {\n      this.state = state;\n      this.emit('stateChanged');\n    }\n  }, {\n    key: \"send\",\n    value: function send() {\n      var _this5 = this;\n\n      this.stateChanged(C.STATUS_CALLING);\n      this.B = setTimeout(function () {\n        _this5.timer_B();\n      }, Timers.TIMER_B);\n\n      if (!this.transport.send(this.request)) {\n        this.onTransportError();\n      }\n    }\n  }, {\n    key: \"onTransportError\",\n    value: function onTransportError() {\n      clearTimeout(this.B);\n      clearTimeout(this.D);\n      clearTimeout(this.M);\n\n      if (this.state !== C.STATUS_ACCEPTED) {\n        loggerict.debug(\"transport error occurred, deleting transaction \".concat(this.id));\n        this.eventHandlers.onTransportError();\n      }\n\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n    } // RFC 6026 7.2.\n\n  }, {\n    key: \"timer_M\",\n    value: function timer_M() {\n      loggerict.debug(\"Timer M expired for transaction \".concat(this.id));\n\n      if (this.state === C.STATUS_ACCEPTED) {\n        clearTimeout(this.B);\n        this.stateChanged(C.STATUS_TERMINATED);\n        this.ua.destroyTransaction(this);\n      }\n    } // RFC 3261 17.1.1.\n\n  }, {\n    key: \"timer_B\",\n    value: function timer_B() {\n      loggerict.debug(\"Timer B expired for transaction \".concat(this.id));\n\n      if (this.state === C.STATUS_CALLING) {\n        this.stateChanged(C.STATUS_TERMINATED);\n        this.ua.destroyTransaction(this);\n        this.eventHandlers.onRequestTimeout();\n      }\n    }\n  }, {\n    key: \"timer_D\",\n    value: function timer_D() {\n      loggerict.debug(\"Timer D expired for transaction \".concat(this.id));\n      clearTimeout(this.B);\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n    }\n  }, {\n    key: \"sendACK\",\n    value: function sendACK(response) {\n      var _this6 = this;\n\n      var ack = new SIPMessage.OutgoingRequest(JsSIP_C.ACK, this.request.ruri, this.ua, {\n        'route_set': this.request.getHeaders('route'),\n        'call_id': this.request.getHeader('call-id'),\n        'cseq': this.request.cseq\n      });\n      ack.setHeader('from', this.request.getHeader('from'));\n      ack.setHeader('via', this.request.getHeader('via'));\n      ack.setHeader('to', response.getHeader('to'));\n      this.D = setTimeout(function () {\n        _this6.timer_D();\n      }, Timers.TIMER_D);\n      this.transport.send(ack);\n    }\n  }, {\n    key: \"cancel\",\n    value: function cancel(reason) {\n      // Send only if a provisional response (>100) has been received.\n      if (this.state !== C.STATUS_PROCEEDING) {\n        return;\n      }\n\n      var cancel = new SIPMessage.OutgoingRequest(JsSIP_C.CANCEL, this.request.ruri, this.ua, {\n        'route_set': this.request.getHeaders('route'),\n        'call_id': this.request.getHeader('call-id'),\n        'cseq': this.request.cseq\n      });\n      cancel.setHeader('from', this.request.getHeader('from'));\n      cancel.setHeader('via', this.request.getHeader('via'));\n      cancel.setHeader('to', this.request.getHeader('to'));\n\n      if (reason) {\n        cancel.setHeader('reason', reason);\n      }\n\n      this.transport.send(cancel);\n    }\n  }, {\n    key: \"receiveResponse\",\n    value: function receiveResponse(response) {\n      var _this7 = this;\n\n      var status_code = response.status_code;\n\n      if (status_code >= 100 && status_code <= 199) {\n        switch (this.state) {\n          case C.STATUS_CALLING:\n            this.stateChanged(C.STATUS_PROCEEDING);\n            this.eventHandlers.onReceiveResponse(response);\n            break;\n\n          case C.STATUS_PROCEEDING:\n            this.eventHandlers.onReceiveResponse(response);\n            break;\n        }\n      } else if (status_code >= 200 && status_code <= 299) {\n        switch (this.state) {\n          case C.STATUS_CALLING:\n          case C.STATUS_PROCEEDING:\n            this.stateChanged(C.STATUS_ACCEPTED);\n            this.M = setTimeout(function () {\n              _this7.timer_M();\n            }, Timers.TIMER_M);\n            this.eventHandlers.onReceiveResponse(response);\n            break;\n\n          case C.STATUS_ACCEPTED:\n            this.eventHandlers.onReceiveResponse(response);\n            break;\n        }\n      } else if (status_code >= 300 && status_code <= 699) {\n        switch (this.state) {\n          case C.STATUS_CALLING:\n          case C.STATUS_PROCEEDING:\n            this.stateChanged(C.STATUS_COMPLETED);\n            this.sendACK(response);\n            this.eventHandlers.onReceiveResponse(response);\n            break;\n\n          case C.STATUS_COMPLETED:\n            this.sendACK(response);\n            break;\n        }\n      }\n    }\n  }, {\n    key: \"C\",\n    get: function get() {\n      return C;\n    }\n  }]);\n\n  return InviteClientTransaction;\n}(EventEmitter);\n\nvar AckClientTransaction = /*#__PURE__*/function (_EventEmitter3) {\n  _inherits(AckClientTransaction, _EventEmitter3);\n\n  var _super3 = _createSuper(AckClientTransaction);\n\n  function AckClientTransaction(ua, transport, request, eventHandlers) {\n    var _this8;\n\n    _classCallCheck(this, AckClientTransaction);\n\n    _this8 = _super3.call(this);\n    _this8.id = \"z9hG4bK\".concat(Math.floor(Math.random() * 10000000));\n    _this8.transport = transport;\n    _this8.request = request;\n    _this8.eventHandlers = eventHandlers;\n    var via = \"SIP/2.0/\".concat(transport.via_transport);\n    via += \" \".concat(ua.configuration.via_host, \";branch=\").concat(_this8.id);\n\n    _this8.request.setHeader('via', via);\n\n    return _this8;\n  }\n\n  _createClass(AckClientTransaction, [{\n    key: \"send\",\n    value: function send() {\n      if (!this.transport.send(this.request)) {\n        this.onTransportError();\n      }\n    }\n  }, {\n    key: \"onTransportError\",\n    value: function onTransportError() {\n      loggeract.debug(\"transport error occurred for transaction \".concat(this.id));\n      this.eventHandlers.onTransportError();\n    }\n  }, {\n    key: \"C\",\n    get: function get() {\n      return C;\n    }\n  }]);\n\n  return AckClientTransaction;\n}(EventEmitter);\n\nvar NonInviteServerTransaction = /*#__PURE__*/function (_EventEmitter4) {\n  _inherits(NonInviteServerTransaction, _EventEmitter4);\n\n  var _super4 = _createSuper(NonInviteServerTransaction);\n\n  function NonInviteServerTransaction(ua, transport, request) {\n    var _this9;\n\n    _classCallCheck(this, NonInviteServerTransaction);\n\n    _this9 = _super4.call(this);\n    _this9.type = C.NON_INVITE_SERVER;\n    _this9.id = request.via_branch;\n    _this9.ua = ua;\n    _this9.transport = transport;\n    _this9.request = request;\n    _this9.last_response = '';\n    request.server_transaction = _assertThisInitialized(_this9);\n    _this9.state = C.STATUS_TRYING;\n    ua.newTransaction(_assertThisInitialized(_this9));\n    return _this9;\n  }\n\n  _createClass(NonInviteServerTransaction, [{\n    key: \"stateChanged\",\n    value: function stateChanged(state) {\n      this.state = state;\n      this.emit('stateChanged');\n    }\n  }, {\n    key: \"timer_J\",\n    value: function timer_J() {\n      loggernist.debug(\"Timer J expired for transaction \".concat(this.id));\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n    }\n  }, {\n    key: \"onTransportError\",\n    value: function onTransportError() {\n      if (!this.transportError) {\n        this.transportError = true;\n        loggernist.debug(\"transport error occurred, deleting transaction \".concat(this.id));\n        clearTimeout(this.J);\n        this.stateChanged(C.STATUS_TERMINATED);\n        this.ua.destroyTransaction(this);\n      }\n    }\n  }, {\n    key: \"receiveResponse\",\n    value: function receiveResponse(status_code, response, onSuccess, onFailure) {\n      var _this10 = this;\n\n      if (status_code === 100) {\n        /* RFC 4320 4.1\n         * 'A SIP element MUST NOT\n         * send any provisional response with a\n         * Status-Code other than 100 to a non-INVITE request.'\n         */\n        switch (this.state) {\n          case C.STATUS_TRYING:\n            this.stateChanged(C.STATUS_PROCEEDING);\n\n            if (!this.transport.send(response)) {\n              this.onTransportError();\n            }\n\n            break;\n\n          case C.STATUS_PROCEEDING:\n            this.last_response = response;\n\n            if (!this.transport.send(response)) {\n              this.onTransportError();\n\n              if (onFailure) {\n                onFailure();\n              }\n            } else if (onSuccess) {\n              onSuccess();\n            }\n\n            break;\n        }\n      } else if (status_code >= 200 && status_code <= 699) {\n        switch (this.state) {\n          case C.STATUS_TRYING:\n          case C.STATUS_PROCEEDING:\n            this.stateChanged(C.STATUS_COMPLETED);\n            this.last_response = response;\n            this.J = setTimeout(function () {\n              _this10.timer_J();\n            }, Timers.TIMER_J);\n\n            if (!this.transport.send(response)) {\n              this.onTransportError();\n\n              if (onFailure) {\n                onFailure();\n              }\n            } else if (onSuccess) {\n              onSuccess();\n            }\n\n            break;\n\n          case C.STATUS_COMPLETED:\n            break;\n        }\n      }\n    }\n  }, {\n    key: \"C\",\n    get: function get() {\n      return C;\n    }\n  }]);\n\n  return NonInviteServerTransaction;\n}(EventEmitter);\n\nvar InviteServerTransaction = /*#__PURE__*/function (_EventEmitter5) {\n  _inherits(InviteServerTransaction, _EventEmitter5);\n\n  var _super5 = _createSuper(InviteServerTransaction);\n\n  function InviteServerTransaction(ua, transport, request) {\n    var _this11;\n\n    _classCallCheck(this, InviteServerTransaction);\n\n    _this11 = _super5.call(this);\n    _this11.type = C.INVITE_SERVER;\n    _this11.id = request.via_branch;\n    _this11.ua = ua;\n    _this11.transport = transport;\n    _this11.request = request;\n    _this11.last_response = '';\n    request.server_transaction = _assertThisInitialized(_this11);\n    _this11.state = C.STATUS_PROCEEDING;\n    ua.newTransaction(_assertThisInitialized(_this11));\n    _this11.resendProvisionalTimer = null;\n    request.reply(100);\n    return _this11;\n  }\n\n  _createClass(InviteServerTransaction, [{\n    key: \"stateChanged\",\n    value: function stateChanged(state) {\n      this.state = state;\n      this.emit('stateChanged');\n    }\n  }, {\n    key: \"timer_H\",\n    value: function timer_H() {\n      loggerist.debug(\"Timer H expired for transaction \".concat(this.id));\n\n      if (this.state === C.STATUS_COMPLETED) {\n        loggerist.debug('ACK not received, dialog will be terminated');\n      }\n\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n    }\n  }, {\n    key: \"timer_I\",\n    value: function timer_I() {\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n    } // RFC 6026 7.1.\n\n  }, {\n    key: \"timer_L\",\n    value: function timer_L() {\n      loggerist.debug(\"Timer L expired for transaction \".concat(this.id));\n\n      if (this.state === C.STATUS_ACCEPTED) {\n        this.stateChanged(C.STATUS_TERMINATED);\n        this.ua.destroyTransaction(this);\n      }\n    }\n  }, {\n    key: \"onTransportError\",\n    value: function onTransportError() {\n      if (!this.transportError) {\n        this.transportError = true;\n        loggerist.debug(\"transport error occurred, deleting transaction \".concat(this.id));\n\n        if (this.resendProvisionalTimer !== null) {\n          clearInterval(this.resendProvisionalTimer);\n          this.resendProvisionalTimer = null;\n        }\n\n        clearTimeout(this.L);\n        clearTimeout(this.H);\n        clearTimeout(this.I);\n        this.stateChanged(C.STATUS_TERMINATED);\n        this.ua.destroyTransaction(this);\n      }\n    }\n  }, {\n    key: \"resend_provisional\",\n    value: function resend_provisional() {\n      if (!this.transport.send(this.last_response)) {\n        this.onTransportError();\n      }\n    } // INVITE Server Transaction RFC 3261 17.2.1.\n\n  }, {\n    key: \"receiveResponse\",\n    value: function receiveResponse(status_code, response, onSuccess, onFailure) {\n      var _this12 = this;\n\n      if (status_code >= 100 && status_code <= 199) {\n        switch (this.state) {\n          case C.STATUS_PROCEEDING:\n            if (!this.transport.send(response)) {\n              this.onTransportError();\n            }\n\n            this.last_response = response;\n            break;\n        }\n      }\n\n      if (status_code > 100 && status_code <= 199 && this.state === C.STATUS_PROCEEDING) {\n        // Trigger the resendProvisionalTimer only for the first non 100 provisional response.\n        if (this.resendProvisionalTimer === null) {\n          this.resendProvisionalTimer = setInterval(function () {\n            _this12.resend_provisional();\n          }, Timers.PROVISIONAL_RESPONSE_INTERVAL);\n        }\n      } else if (status_code >= 200 && status_code <= 299) {\n        switch (this.state) {\n          case C.STATUS_PROCEEDING:\n            this.stateChanged(C.STATUS_ACCEPTED);\n            this.last_response = response;\n            this.L = setTimeout(function () {\n              _this12.timer_L();\n            }, Timers.TIMER_L);\n\n            if (this.resendProvisionalTimer !== null) {\n              clearInterval(this.resendProvisionalTimer);\n              this.resendProvisionalTimer = null;\n            }\n\n          /* falls through */\n\n          case C.STATUS_ACCEPTED:\n            // Note that this point will be reached for proceeding this.state also.\n            if (!this.transport.send(response)) {\n              this.onTransportError();\n\n              if (onFailure) {\n                onFailure();\n              }\n            } else if (onSuccess) {\n              onSuccess();\n            }\n\n            break;\n        }\n      } else if (status_code >= 300 && status_code <= 699) {\n        switch (this.state) {\n          case C.STATUS_PROCEEDING:\n            if (this.resendProvisionalTimer !== null) {\n              clearInterval(this.resendProvisionalTimer);\n              this.resendProvisionalTimer = null;\n            }\n\n            if (!this.transport.send(response)) {\n              this.onTransportError();\n\n              if (onFailure) {\n                onFailure();\n              }\n            } else {\n              this.stateChanged(C.STATUS_COMPLETED);\n              this.H = setTimeout(function () {\n                _this12.timer_H();\n              }, Timers.TIMER_H);\n\n              if (onSuccess) {\n                onSuccess();\n              }\n            }\n\n            break;\n        }\n      }\n    }\n  }, {\n    key: \"C\",\n    get: function get() {\n      return C;\n    }\n  }]);\n\n  return InviteServerTransaction;\n}(EventEmitter);\n/**\n * INVITE:\n *  _true_ if retransmission\n *  _false_ new request\n *\n * ACK:\n *  _true_  ACK to non2xx response\n *  _false_ ACK must be passed to TU (accepted state)\n *          ACK to 2xx response\n *\n * CANCEL:\n *  _true_  no matching invite transaction\n *  _false_ matching invite transaction and no final response sent\n *\n * OTHER:\n *  _true_  retransmission\n *  _false_ new request\n */\n\n\nfunction checkTransaction(_ref, request) {\n  var _transactions = _ref._transactions;\n  var tr;\n\n  switch (request.method) {\n    case JsSIP_C.INVITE:\n      tr = _transactions.ist[request.via_branch];\n\n      if (tr) {\n        switch (tr.state) {\n          case C.STATUS_PROCEEDING:\n            tr.transport.send(tr.last_response);\n            break;\n          // RFC 6026 7.1 Invite retransmission.\n          // Received while in C.STATUS_ACCEPTED state. Absorb it.\n\n          case C.STATUS_ACCEPTED:\n            break;\n        }\n\n        return true;\n      }\n\n      break;\n\n    case JsSIP_C.ACK:\n      tr = _transactions.ist[request.via_branch]; // RFC 6026 7.1.\n\n      if (tr) {\n        if (tr.state === C.STATUS_ACCEPTED) {\n          return false;\n        } else if (tr.state === C.STATUS_COMPLETED) {\n          tr.state = C.STATUS_CONFIRMED;\n          tr.I = setTimeout(function () {\n            tr.timer_I();\n          }, Timers.TIMER_I);\n          return true;\n        }\n      } // ACK to 2XX Response.\n      else {\n          return false;\n        }\n\n      break;\n\n    case JsSIP_C.CANCEL:\n      tr = _transactions.ist[request.via_branch];\n\n      if (tr) {\n        request.reply_sl(200);\n\n        if (tr.state === C.STATUS_PROCEEDING) {\n          return false;\n        } else {\n          return true;\n        }\n      } else {\n        request.reply_sl(481);\n        return true;\n      }\n\n    default:\n      // Non-INVITE Server Transaction RFC 3261 17.2.2.\n      tr = _transactions.nist[request.via_branch];\n\n      if (tr) {\n        switch (tr.state) {\n          case C.STATUS_TRYING:\n            break;\n\n          case C.STATUS_PROCEEDING:\n          case C.STATUS_COMPLETED:\n            tr.transport.send(tr.last_response);\n            break;\n        }\n\n        return true;\n      }\n\n      break;\n  }\n}\n\nmodule.exports = {\n  C: C,\n  NonInviteClientTransaction: NonInviteClientTransaction,\n  InviteClientTransaction: InviteClientTransaction,\n  AckClientTransaction: AckClientTransaction,\n  NonInviteServerTransaction: NonInviteServerTransaction,\n  InviteServerTransaction: InviteServerTransaction,\n  checkTransaction: checkTransaction\n};"]},"metadata":{},"sourceType":"script"}