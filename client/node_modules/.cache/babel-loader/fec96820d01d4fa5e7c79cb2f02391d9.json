{"ast":null,"code":"\"use strict\";\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) {\n  var it;\n\n  if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) {\n    if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n\n      var F = function F() {};\n\n      return {\n        s: F,\n        n: function n() {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function e(_e) {\n          throw _e;\n        },\n        f: F\n      };\n    }\n\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n\n  var normalCompletion = true,\n      didErr = false,\n      err;\n  return {\n    s: function s() {\n      it = o[Symbol.iterator]();\n    },\n    n: function n() {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function e(_e2) {\n      didErr = true;\n      err = _e2;\n    },\n    f: function f() {\n      try {\n        if (!normalCompletion && it[\"return\"] != null) it[\"return\"]();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nvar sdp_transform = require('sdp-transform');\n\nvar Logger = require('./Logger');\n\nvar JsSIP_C = require('./Constants');\n\nvar Utils = require('./Utils');\n\nvar NameAddrHeader = require('./NameAddrHeader');\n\nvar Grammar = require('./Grammar');\n\nvar logger = new Logger('SIPMessage');\n/**\n * -param {String} method request method\n * -param {String} ruri request uri\n * -param {UA} ua\n * -param {Object} params parameters that will have priority over ua.configuration parameters:\n * <br>\n *  - cseq, call_id, from_tag, from_uri, from_display_name, to_uri, to_tag, route_set\n * -param {Object} [headers] extra headers\n * -param {String} [body]\n */\n\nvar OutgoingRequest = /*#__PURE__*/function () {\n  function OutgoingRequest(method, ruri, ua, params, extraHeaders, body) {\n    _classCallCheck(this, OutgoingRequest); // Mandatory parameters check.\n\n\n    if (!method || !ruri || !ua) {\n      return null;\n    }\n\n    params = params || {};\n    this.ua = ua;\n    this.headers = {};\n    this.method = method;\n    this.ruri = ruri;\n    this.body = body;\n    this.extraHeaders = Utils.cloneArray(extraHeaders); // Fill the Common SIP Request Headers.\n    // Route.\n\n    if (params.route_set) {\n      this.setHeader('route', params.route_set);\n    } else if (ua.configuration.use_preloaded_route) {\n      this.setHeader('route', \"<\".concat(ua.transport.sip_uri, \";lr>\"));\n    } // Via.\n    // Empty Via header. Will be filled by the client transaction.\n\n\n    this.setHeader('via', ''); // Max-Forwards.\n\n    this.setHeader('max-forwards', JsSIP_C.MAX_FORWARDS); // To\n\n    var to_uri = params.to_uri || ruri;\n    var to_params = params.to_tag ? {\n      tag: params.to_tag\n    } : null;\n    var to_display_name = typeof params.to_display_name !== 'undefined' ? params.to_display_name : null;\n    this.to = new NameAddrHeader(to_uri, to_display_name, to_params);\n    this.setHeader('to', this.to.toString()); // From.\n\n    var from_uri = params.from_uri || ua.configuration.uri;\n    var from_params = {\n      tag: params.from_tag || Utils.newTag()\n    };\n    var display_name;\n\n    if (typeof params.from_display_name !== 'undefined') {\n      display_name = params.from_display_name;\n    } else if (ua.configuration.display_name) {\n      display_name = ua.configuration.display_name;\n    } else {\n      display_name = null;\n    }\n\n    this.from = new NameAddrHeader(from_uri, display_name, from_params);\n    this.setHeader('from', this.from.toString()); // Call-ID.\n\n    var call_id = params.call_id || ua.configuration.jssip_id + Utils.createRandomToken(15);\n    this.call_id = call_id;\n    this.setHeader('call-id', call_id); // CSeq.\n\n    var cseq = params.cseq || Math.floor(Math.random() * 10000);\n    this.cseq = cseq;\n    this.setHeader('cseq', \"\".concat(cseq, \" \").concat(method));\n  }\n  /**\n   * Replace the the given header by the given value.\n   * -param {String} name header name\n   * -param {String | Array} value header value\n   */\n\n\n  _createClass(OutgoingRequest, [{\n    key: \"setHeader\",\n    value: function setHeader(name, value) {\n      // Remove the header from extraHeaders if present.\n      var regexp = new RegExp(\"^\\\\s*\".concat(name, \"\\\\s*:\"), 'i');\n\n      for (var idx = 0; idx < this.extraHeaders.length; idx++) {\n        if (regexp.test(this.extraHeaders[idx])) {\n          this.extraHeaders.splice(idx, 1);\n        }\n      }\n\n      this.headers[Utils.headerize(name)] = Array.isArray(value) ? value : [value];\n    }\n    /**\n     * Get the value of the given header name at the given position.\n     * -param {String} name header name\n     * -returns {String|undefined} Returns the specified header, null if header doesn't exist.\n     */\n\n  }, {\n    key: \"getHeader\",\n    value: function getHeader(name) {\n      var headers = this.headers[Utils.headerize(name)];\n\n      if (headers) {\n        if (headers[0]) {\n          return headers[0];\n        }\n      } else {\n        var regexp = new RegExp(\"^\\\\s*\".concat(name, \"\\\\s*:\"), 'i');\n\n        var _iterator = _createForOfIteratorHelper(this.extraHeaders),\n            _step;\n\n        try {\n          for (_iterator.s(); !(_step = _iterator.n()).done;) {\n            var header = _step.value;\n\n            if (regexp.test(header)) {\n              return header.substring(header.indexOf(':') + 1).trim();\n            }\n          }\n        } catch (err) {\n          _iterator.e(err);\n        } finally {\n          _iterator.f();\n        }\n      }\n\n      return;\n    }\n    /**\n     * Get the header/s of the given name.\n     * -param {String} name header name\n     * -returns {Array} Array with all the headers of the specified name.\n     */\n\n  }, {\n    key: \"getHeaders\",\n    value: function getHeaders(name) {\n      var headers = this.headers[Utils.headerize(name)];\n      var result = [];\n\n      if (headers) {\n        var _iterator2 = _createForOfIteratorHelper(headers),\n            _step2;\n\n        try {\n          for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n            var header = _step2.value;\n            result.push(header);\n          }\n        } catch (err) {\n          _iterator2.e(err);\n        } finally {\n          _iterator2.f();\n        }\n\n        return result;\n      } else {\n        var regexp = new RegExp(\"^\\\\s*\".concat(name, \"\\\\s*:\"), 'i');\n\n        var _iterator3 = _createForOfIteratorHelper(this.extraHeaders),\n            _step3;\n\n        try {\n          for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n            var _header = _step3.value;\n\n            if (regexp.test(_header)) {\n              result.push(_header.substring(_header.indexOf(':') + 1).trim());\n            }\n          }\n        } catch (err) {\n          _iterator3.e(err);\n        } finally {\n          _iterator3.f();\n        }\n\n        return result;\n      }\n    }\n    /**\n     * Verify the existence of the given header.\n     * -param {String} name header name\n     * -returns {boolean} true if header with given name exists, false otherwise\n     */\n\n  }, {\n    key: \"hasHeader\",\n    value: function hasHeader(name) {\n      if (this.headers[Utils.headerize(name)]) {\n        return true;\n      } else {\n        var regexp = new RegExp(\"^\\\\s*\".concat(name, \"\\\\s*:\"), 'i');\n\n        var _iterator4 = _createForOfIteratorHelper(this.extraHeaders),\n            _step4;\n\n        try {\n          for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {\n            var header = _step4.value;\n\n            if (regexp.test(header)) {\n              return true;\n            }\n          }\n        } catch (err) {\n          _iterator4.e(err);\n        } finally {\n          _iterator4.f();\n        }\n      }\n\n      return false;\n    }\n    /**\n     * Parse the current body as a SDP and store the resulting object\n     * into this.sdp.\n     * -param {Boolean} force: Parse even if this.sdp already exists.\n     *\n     * Returns this.sdp.\n     */\n\n  }, {\n    key: \"parseSDP\",\n    value: function parseSDP(force) {\n      if (!force && this.sdp) {\n        return this.sdp;\n      } else {\n        this.sdp = sdp_transform.parse(this.body || '');\n        return this.sdp;\n      }\n    }\n  }, {\n    key: \"toString\",\n    value: function toString() {\n      var msg = \"\".concat(this.method, \" \").concat(this.ruri, \" SIP/2.0\\r\\n\");\n\n      for (var headerName in this.headers) {\n        if (Object.prototype.hasOwnProperty.call(this.headers, headerName)) {\n          var _iterator5 = _createForOfIteratorHelper(this.headers[headerName]),\n              _step5;\n\n          try {\n            for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {\n              var headerValue = _step5.value;\n              msg += \"\".concat(headerName, \": \").concat(headerValue, \"\\r\\n\");\n            }\n          } catch (err) {\n            _iterator5.e(err);\n          } finally {\n            _iterator5.f();\n          }\n        }\n      }\n\n      var _iterator6 = _createForOfIteratorHelper(this.extraHeaders),\n          _step6;\n\n      try {\n        for (_iterator6.s(); !(_step6 = _iterator6.n()).done;) {\n          var header = _step6.value;\n          msg += \"\".concat(header.trim(), \"\\r\\n\");\n        } // Supported.\n\n      } catch (err) {\n        _iterator6.e(err);\n      } finally {\n        _iterator6.f();\n      }\n\n      var supported = [];\n\n      switch (this.method) {\n        case JsSIP_C.REGISTER:\n          supported.push('path', 'gruu');\n          break;\n\n        case JsSIP_C.INVITE:\n          if (this.ua.configuration.session_timers) {\n            supported.push('timer');\n          }\n\n          if (this.ua.contact.pub_gruu || this.ua.contact.temp_gruu) {\n            supported.push('gruu');\n          }\n\n          supported.push('ice', 'replaces');\n          break;\n\n        case JsSIP_C.UPDATE:\n          if (this.ua.configuration.session_timers) {\n            supported.push('timer');\n          }\n\n          supported.push('ice');\n          break;\n      }\n\n      supported.push('outbound');\n      var userAgent = this.ua.configuration.user_agent || JsSIP_C.USER_AGENT; // Allow.\n\n      msg += \"Allow: \".concat(JsSIP_C.ALLOWED_METHODS, \"\\r\\n\");\n      msg += \"Supported: \".concat(supported, \"\\r\\n\");\n      msg += \"User-Agent: \".concat(userAgent, \"\\r\\n\");\n\n      if (this.body) {\n        var length = Utils.str_utf8_length(this.body);\n        msg += \"Content-Length: \".concat(length, \"\\r\\n\\r\\n\");\n        msg += this.body;\n      } else {\n        msg += 'Content-Length: 0\\r\\n\\r\\n';\n      }\n\n      return msg;\n    }\n  }, {\n    key: \"clone\",\n    value: function clone() {\n      var request = new OutgoingRequest(this.method, this.ruri, this.ua);\n      Object.keys(this.headers).forEach(function (name) {\n        request.headers[name] = this.headers[name].slice();\n      }, this);\n      request.body = this.body;\n      request.extraHeaders = Utils.cloneArray(this.extraHeaders);\n      request.to = this.to;\n      request.from = this.from;\n      request.call_id = this.call_id;\n      request.cseq = this.cseq;\n      return request;\n    }\n  }]);\n\n  return OutgoingRequest;\n}();\n\nvar InitialOutgoingInviteRequest = /*#__PURE__*/function (_OutgoingRequest) {\n  _inherits(InitialOutgoingInviteRequest, _OutgoingRequest);\n\n  var _super = _createSuper(InitialOutgoingInviteRequest);\n\n  function InitialOutgoingInviteRequest(ruri, ua, params, extraHeaders, body) {\n    var _this;\n\n    _classCallCheck(this, InitialOutgoingInviteRequest);\n\n    _this = _super.call(this, JsSIP_C.INVITE, ruri, ua, params, extraHeaders, body);\n    _this.transaction = null;\n    return _this;\n  }\n\n  _createClass(InitialOutgoingInviteRequest, [{\n    key: \"cancel\",\n    value: function cancel(reason) {\n      this.transaction.cancel(reason);\n    }\n  }, {\n    key: \"clone\",\n    value: function clone() {\n      var request = new InitialOutgoingInviteRequest(this.ruri, this.ua);\n      Object.keys(this.headers).forEach(function (name) {\n        request.headers[name] = this.headers[name].slice();\n      }, this);\n      request.body = this.body;\n      request.extraHeaders = Utils.cloneArray(this.extraHeaders);\n      request.to = this.to;\n      request.from = this.from;\n      request.call_id = this.call_id;\n      request.cseq = this.cseq;\n      request.transaction = this.transaction;\n      return request;\n    }\n  }]);\n\n  return InitialOutgoingInviteRequest;\n}(OutgoingRequest);\n\nvar IncomingMessage = /*#__PURE__*/function () {\n  function IncomingMessage() {\n    _classCallCheck(this, IncomingMessage);\n\n    this.data = null;\n    this.headers = null;\n    this.method = null;\n    this.via = null;\n    this.via_branch = null;\n    this.call_id = null;\n    this.cseq = null;\n    this.from = null;\n    this.from_tag = null;\n    this.to = null;\n    this.to_tag = null;\n    this.body = null;\n    this.sdp = null;\n  }\n  /**\n  * Insert a header of the given name and value into the last position of the\n  * header array.\n  */\n\n\n  _createClass(IncomingMessage, [{\n    key: \"addHeader\",\n    value: function addHeader(name, value) {\n      var header = {\n        raw: value\n      };\n      name = Utils.headerize(name);\n\n      if (this.headers[name]) {\n        this.headers[name].push(header);\n      } else {\n        this.headers[name] = [header];\n      }\n    }\n    /**\n     * Get the value of the given header name at the given position.\n     */\n\n  }, {\n    key: \"getHeader\",\n    value: function getHeader(name) {\n      var header = this.headers[Utils.headerize(name)];\n\n      if (header) {\n        if (header[0]) {\n          return header[0].raw;\n        }\n      } else {\n        return;\n      }\n    }\n    /**\n     * Get the header/s of the given name.\n     */\n\n  }, {\n    key: \"getHeaders\",\n    value: function getHeaders(name) {\n      var headers = this.headers[Utils.headerize(name)];\n      var result = [];\n\n      if (!headers) {\n        return [];\n      }\n\n      var _iterator7 = _createForOfIteratorHelper(headers),\n          _step7;\n\n      try {\n        for (_iterator7.s(); !(_step7 = _iterator7.n()).done;) {\n          var header = _step7.value;\n          result.push(header.raw);\n        }\n      } catch (err) {\n        _iterator7.e(err);\n      } finally {\n        _iterator7.f();\n      }\n\n      return result;\n    }\n    /**\n     * Verify the existence of the given header.\n     */\n\n  }, {\n    key: \"hasHeader\",\n    value: function hasHeader(name) {\n      return this.headers[Utils.headerize(name)] ? true : false;\n    }\n    /**\n    * Parse the given header on the given index.\n    * -param {String} name header name\n    * -param {Number} [idx=0] header index\n    * -returns {Object|undefined} Parsed header object, undefined if the header\n    *  is not present or in case of a parsing error.\n    */\n\n  }, {\n    key: \"parseHeader\",\n    value: function parseHeader(name) {\n      var idx = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      name = Utils.headerize(name);\n\n      if (!this.headers[name]) {\n        logger.debug(\"header \\\"\".concat(name, \"\\\" not present\"));\n        return;\n      } else if (idx >= this.headers[name].length) {\n        logger.debug(\"not so many \\\"\".concat(name, \"\\\" headers present\"));\n        return;\n      }\n\n      var header = this.headers[name][idx];\n      var value = header.raw;\n\n      if (header.parsed) {\n        return header.parsed;\n      } // Substitute '-' by '_' for grammar rule matching.\n\n\n      var parsed = Grammar.parse(value, name.replace(/-/g, '_'));\n\n      if (parsed === -1) {\n        this.headers[name].splice(idx, 1); // delete from headers\n\n        logger.debug(\"error parsing \\\"\".concat(name, \"\\\" header field with value \\\"\").concat(value, \"\\\"\"));\n        return;\n      } else {\n        header.parsed = parsed;\n        return parsed;\n      }\n    }\n    /**\n     * Message Header attribute selector. Alias of parseHeader.\n     * -param {String} name header name\n     * -param {Number} [idx=0] header index\n     * -returns {Object|undefined} Parsed header object, undefined if the header\n     *  is not present or in case of a parsing error.\n     *\n     * -example\n     * message.s('via',3).port\n     */\n\n  }, {\n    key: \"s\",\n    value: function s(name, idx) {\n      return this.parseHeader(name, idx);\n    }\n    /**\n    * Replace the value of the given header by the value.\n    * -param {String} name header name\n    * -param {String} value header value\n    */\n\n  }, {\n    key: \"setHeader\",\n    value: function setHeader(name, value) {\n      var header = {\n        raw: value\n      };\n      this.headers[Utils.headerize(name)] = [header];\n    }\n    /**\n     * Parse the current body as a SDP and store the resulting object\n     * into this.sdp.\n     * -param {Boolean} force: Parse even if this.sdp already exists.\n     *\n     * Returns this.sdp.\n     */\n\n  }, {\n    key: \"parseSDP\",\n    value: function parseSDP(force) {\n      if (!force && this.sdp) {\n        return this.sdp;\n      } else {\n        this.sdp = sdp_transform.parse(this.body || '');\n        return this.sdp;\n      }\n    }\n  }, {\n    key: \"toString\",\n    value: function toString() {\n      return this.data;\n    }\n  }]);\n\n  return IncomingMessage;\n}();\n\nvar IncomingRequest = /*#__PURE__*/function (_IncomingMessage) {\n  _inherits(IncomingRequest, _IncomingMessage);\n\n  var _super2 = _createSuper(IncomingRequest);\n\n  function IncomingRequest(ua) {\n    var _this2;\n\n    _classCallCheck(this, IncomingRequest);\n\n    _this2 = _super2.call(this);\n    _this2.ua = ua;\n    _this2.headers = {};\n    _this2.ruri = null;\n    _this2.transport = null;\n    _this2.server_transaction = null;\n    return _this2;\n  }\n  /**\n  * Stateful reply.\n  * -param {Number} code status code\n  * -param {String} reason reason phrase\n  * -param {Object} headers extra headers\n  * -param {String} body body\n  * -param {Function} [onSuccess] onSuccess callback\n  * -param {Function} [onFailure] onFailure callback\n  */\n\n\n  _createClass(IncomingRequest, [{\n    key: \"reply\",\n    value: function reply(code, reason, extraHeaders, body, onSuccess, onFailure) {\n      var supported = [];\n      var to = this.getHeader('To');\n      code = code || null;\n      reason = reason || null; // Validate code and reason values.\n\n      if (!code || code < 100 || code > 699) {\n        throw new TypeError(\"Invalid status_code: \".concat(code));\n      } else if (reason && typeof reason !== 'string' && !(reason instanceof String)) {\n        throw new TypeError(\"Invalid reason_phrase: \".concat(reason));\n      }\n\n      reason = reason || JsSIP_C.REASON_PHRASE[code] || '';\n      extraHeaders = Utils.cloneArray(extraHeaders);\n      var response = \"SIP/2.0 \".concat(code, \" \").concat(reason, \"\\r\\n\");\n\n      if (this.method === JsSIP_C.INVITE && code > 100 && code <= 200) {\n        var headers = this.getHeaders('record-route');\n\n        var _iterator8 = _createForOfIteratorHelper(headers),\n            _step8;\n\n        try {\n          for (_iterator8.s(); !(_step8 = _iterator8.n()).done;) {\n            var header = _step8.value;\n            response += \"Record-Route: \".concat(header, \"\\r\\n\");\n          }\n        } catch (err) {\n          _iterator8.e(err);\n        } finally {\n          _iterator8.f();\n        }\n      }\n\n      var vias = this.getHeaders('via');\n\n      var _iterator9 = _createForOfIteratorHelper(vias),\n          _step9;\n\n      try {\n        for (_iterator9.s(); !(_step9 = _iterator9.n()).done;) {\n          var via = _step9.value;\n          response += \"Via: \".concat(via, \"\\r\\n\");\n        }\n      } catch (err) {\n        _iterator9.e(err);\n      } finally {\n        _iterator9.f();\n      }\n\n      if (!this.to_tag && code > 100) {\n        to += \";tag=\".concat(Utils.newTag());\n      } else if (this.to_tag && !this.s('to').hasParam('tag')) {\n        to += \";tag=\".concat(this.to_tag);\n      }\n\n      response += \"To: \".concat(to, \"\\r\\n\");\n      response += \"From: \".concat(this.getHeader('From'), \"\\r\\n\");\n      response += \"Call-ID: \".concat(this.call_id, \"\\r\\n\");\n      response += \"CSeq: \".concat(this.cseq, \" \").concat(this.method, \"\\r\\n\");\n\n      var _iterator10 = _createForOfIteratorHelper(extraHeaders),\n          _step10;\n\n      try {\n        for (_iterator10.s(); !(_step10 = _iterator10.n()).done;) {\n          var _header2 = _step10.value;\n          response += \"\".concat(_header2.trim(), \"\\r\\n\");\n        } // Supported.\n\n      } catch (err) {\n        _iterator10.e(err);\n      } finally {\n        _iterator10.f();\n      }\n\n      switch (this.method) {\n        case JsSIP_C.INVITE:\n          if (this.ua.configuration.session_timers) {\n            supported.push('timer');\n          }\n\n          if (this.ua.contact.pub_gruu || this.ua.contact.temp_gruu) {\n            supported.push('gruu');\n          }\n\n          supported.push('ice', 'replaces');\n          break;\n\n        case JsSIP_C.UPDATE:\n          if (this.ua.configuration.session_timers) {\n            supported.push('timer');\n          }\n\n          if (body) {\n            supported.push('ice');\n          }\n\n          supported.push('replaces');\n      }\n\n      supported.push('outbound'); // Allow and Accept.\n\n      if (this.method === JsSIP_C.OPTIONS) {\n        response += \"Allow: \".concat(JsSIP_C.ALLOWED_METHODS, \"\\r\\n\");\n        response += \"Accept: \".concat(JsSIP_C.ACCEPTED_BODY_TYPES, \"\\r\\n\");\n      } else if (code === 405) {\n        response += \"Allow: \".concat(JsSIP_C.ALLOWED_METHODS, \"\\r\\n\");\n      } else if (code === 415) {\n        response += \"Accept: \".concat(JsSIP_C.ACCEPTED_BODY_TYPES, \"\\r\\n\");\n      }\n\n      response += \"Supported: \".concat(supported, \"\\r\\n\");\n\n      if (body) {\n        var length = Utils.str_utf8_length(body);\n        response += 'Content-Type: application/sdp\\r\\n';\n        response += \"Content-Length: \".concat(length, \"\\r\\n\\r\\n\");\n        response += body;\n      } else {\n        response += \"Content-Length: \".concat(0, \"\\r\\n\\r\\n\");\n      }\n\n      this.server_transaction.receiveResponse(code, response, onSuccess, onFailure);\n    }\n    /**\n    * Stateless reply.\n    * -param {Number} code status code\n    * -param {String} reason reason phrase\n    */\n\n  }, {\n    key: \"reply_sl\",\n    value: function reply_sl() {\n      var code = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n      var reason = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      var vias = this.getHeaders('via'); // Validate code and reason values.\n\n      if (!code || code < 100 || code > 699) {\n        throw new TypeError(\"Invalid status_code: \".concat(code));\n      } else if (reason && typeof reason !== 'string' && !(reason instanceof String)) {\n        throw new TypeError(\"Invalid reason_phrase: \".concat(reason));\n      }\n\n      reason = reason || JsSIP_C.REASON_PHRASE[code] || '';\n      var response = \"SIP/2.0 \".concat(code, \" \").concat(reason, \"\\r\\n\");\n\n      var _iterator11 = _createForOfIteratorHelper(vias),\n          _step11;\n\n      try {\n        for (_iterator11.s(); !(_step11 = _iterator11.n()).done;) {\n          var via = _step11.value;\n          response += \"Via: \".concat(via, \"\\r\\n\");\n        }\n      } catch (err) {\n        _iterator11.e(err);\n      } finally {\n        _iterator11.f();\n      }\n\n      var to = this.getHeader('To');\n\n      if (!this.to_tag && code > 100) {\n        to += \";tag=\".concat(Utils.newTag());\n      } else if (this.to_tag && !this.s('to').hasParam('tag')) {\n        to += \";tag=\".concat(this.to_tag);\n      }\n\n      response += \"To: \".concat(to, \"\\r\\n\");\n      response += \"From: \".concat(this.getHeader('From'), \"\\r\\n\");\n      response += \"Call-ID: \".concat(this.call_id, \"\\r\\n\");\n      response += \"CSeq: \".concat(this.cseq, \" \").concat(this.method, \"\\r\\n\");\n      response += \"Content-Length: \".concat(0, \"\\r\\n\\r\\n\");\n      this.transport.send(response);\n    }\n  }]);\n\n  return IncomingRequest;\n}(IncomingMessage);\n\nvar IncomingResponse = /*#__PURE__*/function (_IncomingMessage2) {\n  _inherits(IncomingResponse, _IncomingMessage2);\n\n  var _super3 = _createSuper(IncomingResponse);\n\n  function IncomingResponse() {\n    var _this3;\n\n    _classCallCheck(this, IncomingResponse);\n\n    _this3 = _super3.call(this);\n    _this3.headers = {};\n    _this3.status_code = null;\n    _this3.reason_phrase = null;\n    return _this3;\n  }\n\n  return IncomingResponse;\n}(IncomingMessage);\n\nmodule.exports = {\n  OutgoingRequest: OutgoingRequest,\n  InitialOutgoingInviteRequest: InitialOutgoingInviteRequest,\n  IncomingRequest: IncomingRequest,\n  IncomingResponse: IncomingResponse\n};","map":{"version":3,"sources":["/Users/tuphan/Desktop/ubuntuGcalls/client/node_modules/jssip/lib-es5/SIPMessage.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","_inherits","subClass","superClass","TypeError","Object","create","value","writable","configurable","_setPrototypeOf","o","p","setPrototypeOf","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf","result","NewTarget","Reflect","construct","arguments","apply","_possibleConstructorReturn","self","call","_assertThisInitialized","ReferenceError","sham","Proxy","Date","toString","e","getPrototypeOf","_createForOfIteratorHelper","allowArrayLike","it","Array","isArray","_unsupportedIterableToArray","length","i","F","s","n","done","_e","f","normalCompletion","didErr","err","step","next","_e2","minLen","_arrayLikeToArray","slice","name","from","test","arr","len","arr2","_classCallCheck","instance","Constructor","_defineProperties","target","props","descriptor","enumerable","defineProperty","key","_createClass","protoProps","staticProps","sdp_transform","require","Logger","JsSIP_C","Utils","NameAddrHeader","Grammar","logger","OutgoingRequest","method","ruri","ua","params","extraHeaders","body","headers","cloneArray","route_set","setHeader","configuration","use_preloaded_route","concat","transport","sip_uri","MAX_FORWARDS","to_uri","to_params","to_tag","tag","to_display_name","to","from_uri","uri","from_params","from_tag","newTag","display_name","from_display_name","call_id","jssip_id","createRandomToken","cseq","Math","floor","random","regexp","RegExp","idx","splice","headerize","getHeader","_iterator","_step","header","substring","indexOf","trim","getHeaders","_iterator2","_step2","push","_iterator3","_step3","_header","hasHeader","_iterator4","_step4","parseSDP","force","sdp","parse","msg","headerName","hasOwnProperty","_iterator5","_step5","headerValue","_iterator6","_step6","supported","REGISTER","INVITE","session_timers","contact","pub_gruu","temp_gruu","UPDATE","userAgent","user_agent","USER_AGENT","ALLOWED_METHODS","str_utf8_length","clone","request","keys","forEach","InitialOutgoingInviteRequest","_OutgoingRequest","_super","_this","transaction","cancel","reason","IncomingMessage","data","via","via_branch","addHeader","raw","_iterator7","_step7","parseHeader","undefined","debug","parsed","replace","IncomingRequest","_IncomingMessage","_super2","_this2","server_transaction","reply","code","onSuccess","onFailure","String","REASON_PHRASE","response","_iterator8","_step8","vias","_iterator9","_step9","hasParam","_iterator10","_step10","_header2","OPTIONS","ACCEPTED_BODY_TYPES","receiveResponse","reply_sl","_iterator11","_step11","send","IncomingResponse","_IncomingMessage2","_super3","_this3","status_code","reason_phrase","module","exports"],"mappings":"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","sourcesContent":["\"use strict\";\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nvar sdp_transform = require('sdp-transform');\n\nvar Logger = require('./Logger');\n\nvar JsSIP_C = require('./Constants');\n\nvar Utils = require('./Utils');\n\nvar NameAddrHeader = require('./NameAddrHeader');\n\nvar Grammar = require('./Grammar');\n\nvar logger = new Logger('SIPMessage');\n/**\n * -param {String} method request method\n * -param {String} ruri request uri\n * -param {UA} ua\n * -param {Object} params parameters that will have priority over ua.configuration parameters:\n * <br>\n *  - cseq, call_id, from_tag, from_uri, from_display_name, to_uri, to_tag, route_set\n * -param {Object} [headers] extra headers\n * -param {String} [body]\n */\n\nvar OutgoingRequest = /*#__PURE__*/function () {\n  function OutgoingRequest(method, ruri, ua, params, extraHeaders, body) {\n    _classCallCheck(this, OutgoingRequest);\n\n    // Mandatory parameters check.\n    if (!method || !ruri || !ua) {\n      return null;\n    }\n\n    params = params || {};\n    this.ua = ua;\n    this.headers = {};\n    this.method = method;\n    this.ruri = ruri;\n    this.body = body;\n    this.extraHeaders = Utils.cloneArray(extraHeaders); // Fill the Common SIP Request Headers.\n    // Route.\n\n    if (params.route_set) {\n      this.setHeader('route', params.route_set);\n    } else if (ua.configuration.use_preloaded_route) {\n      this.setHeader('route', \"<\".concat(ua.transport.sip_uri, \";lr>\"));\n    } // Via.\n    // Empty Via header. Will be filled by the client transaction.\n\n\n    this.setHeader('via', ''); // Max-Forwards.\n\n    this.setHeader('max-forwards', JsSIP_C.MAX_FORWARDS); // To\n\n    var to_uri = params.to_uri || ruri;\n    var to_params = params.to_tag ? {\n      tag: params.to_tag\n    } : null;\n    var to_display_name = typeof params.to_display_name !== 'undefined' ? params.to_display_name : null;\n    this.to = new NameAddrHeader(to_uri, to_display_name, to_params);\n    this.setHeader('to', this.to.toString()); // From.\n\n    var from_uri = params.from_uri || ua.configuration.uri;\n    var from_params = {\n      tag: params.from_tag || Utils.newTag()\n    };\n    var display_name;\n\n    if (typeof params.from_display_name !== 'undefined') {\n      display_name = params.from_display_name;\n    } else if (ua.configuration.display_name) {\n      display_name = ua.configuration.display_name;\n    } else {\n      display_name = null;\n    }\n\n    this.from = new NameAddrHeader(from_uri, display_name, from_params);\n    this.setHeader('from', this.from.toString()); // Call-ID.\n\n    var call_id = params.call_id || ua.configuration.jssip_id + Utils.createRandomToken(15);\n    this.call_id = call_id;\n    this.setHeader('call-id', call_id); // CSeq.\n\n    var cseq = params.cseq || Math.floor(Math.random() * 10000);\n    this.cseq = cseq;\n    this.setHeader('cseq', \"\".concat(cseq, \" \").concat(method));\n  }\n  /**\n   * Replace the the given header by the given value.\n   * -param {String} name header name\n   * -param {String | Array} value header value\n   */\n\n\n  _createClass(OutgoingRequest, [{\n    key: \"setHeader\",\n    value: function setHeader(name, value) {\n      // Remove the header from extraHeaders if present.\n      var regexp = new RegExp(\"^\\\\s*\".concat(name, \"\\\\s*:\"), 'i');\n\n      for (var idx = 0; idx < this.extraHeaders.length; idx++) {\n        if (regexp.test(this.extraHeaders[idx])) {\n          this.extraHeaders.splice(idx, 1);\n        }\n      }\n\n      this.headers[Utils.headerize(name)] = Array.isArray(value) ? value : [value];\n    }\n    /**\n     * Get the value of the given header name at the given position.\n     * -param {String} name header name\n     * -returns {String|undefined} Returns the specified header, null if header doesn't exist.\n     */\n\n  }, {\n    key: \"getHeader\",\n    value: function getHeader(name) {\n      var headers = this.headers[Utils.headerize(name)];\n\n      if (headers) {\n        if (headers[0]) {\n          return headers[0];\n        }\n      } else {\n        var regexp = new RegExp(\"^\\\\s*\".concat(name, \"\\\\s*:\"), 'i');\n\n        var _iterator = _createForOfIteratorHelper(this.extraHeaders),\n            _step;\n\n        try {\n          for (_iterator.s(); !(_step = _iterator.n()).done;) {\n            var header = _step.value;\n\n            if (regexp.test(header)) {\n              return header.substring(header.indexOf(':') + 1).trim();\n            }\n          }\n        } catch (err) {\n          _iterator.e(err);\n        } finally {\n          _iterator.f();\n        }\n      }\n\n      return;\n    }\n    /**\n     * Get the header/s of the given name.\n     * -param {String} name header name\n     * -returns {Array} Array with all the headers of the specified name.\n     */\n\n  }, {\n    key: \"getHeaders\",\n    value: function getHeaders(name) {\n      var headers = this.headers[Utils.headerize(name)];\n      var result = [];\n\n      if (headers) {\n        var _iterator2 = _createForOfIteratorHelper(headers),\n            _step2;\n\n        try {\n          for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n            var header = _step2.value;\n            result.push(header);\n          }\n        } catch (err) {\n          _iterator2.e(err);\n        } finally {\n          _iterator2.f();\n        }\n\n        return result;\n      } else {\n        var regexp = new RegExp(\"^\\\\s*\".concat(name, \"\\\\s*:\"), 'i');\n\n        var _iterator3 = _createForOfIteratorHelper(this.extraHeaders),\n            _step3;\n\n        try {\n          for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n            var _header = _step3.value;\n\n            if (regexp.test(_header)) {\n              result.push(_header.substring(_header.indexOf(':') + 1).trim());\n            }\n          }\n        } catch (err) {\n          _iterator3.e(err);\n        } finally {\n          _iterator3.f();\n        }\n\n        return result;\n      }\n    }\n    /**\n     * Verify the existence of the given header.\n     * -param {String} name header name\n     * -returns {boolean} true if header with given name exists, false otherwise\n     */\n\n  }, {\n    key: \"hasHeader\",\n    value: function hasHeader(name) {\n      if (this.headers[Utils.headerize(name)]) {\n        return true;\n      } else {\n        var regexp = new RegExp(\"^\\\\s*\".concat(name, \"\\\\s*:\"), 'i');\n\n        var _iterator4 = _createForOfIteratorHelper(this.extraHeaders),\n            _step4;\n\n        try {\n          for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {\n            var header = _step4.value;\n\n            if (regexp.test(header)) {\n              return true;\n            }\n          }\n        } catch (err) {\n          _iterator4.e(err);\n        } finally {\n          _iterator4.f();\n        }\n      }\n\n      return false;\n    }\n    /**\n     * Parse the current body as a SDP and store the resulting object\n     * into this.sdp.\n     * -param {Boolean} force: Parse even if this.sdp already exists.\n     *\n     * Returns this.sdp.\n     */\n\n  }, {\n    key: \"parseSDP\",\n    value: function parseSDP(force) {\n      if (!force && this.sdp) {\n        return this.sdp;\n      } else {\n        this.sdp = sdp_transform.parse(this.body || '');\n        return this.sdp;\n      }\n    }\n  }, {\n    key: \"toString\",\n    value: function toString() {\n      var msg = \"\".concat(this.method, \" \").concat(this.ruri, \" SIP/2.0\\r\\n\");\n\n      for (var headerName in this.headers) {\n        if (Object.prototype.hasOwnProperty.call(this.headers, headerName)) {\n          var _iterator5 = _createForOfIteratorHelper(this.headers[headerName]),\n              _step5;\n\n          try {\n            for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {\n              var headerValue = _step5.value;\n              msg += \"\".concat(headerName, \": \").concat(headerValue, \"\\r\\n\");\n            }\n          } catch (err) {\n            _iterator5.e(err);\n          } finally {\n            _iterator5.f();\n          }\n        }\n      }\n\n      var _iterator6 = _createForOfIteratorHelper(this.extraHeaders),\n          _step6;\n\n      try {\n        for (_iterator6.s(); !(_step6 = _iterator6.n()).done;) {\n          var header = _step6.value;\n          msg += \"\".concat(header.trim(), \"\\r\\n\");\n        } // Supported.\n\n      } catch (err) {\n        _iterator6.e(err);\n      } finally {\n        _iterator6.f();\n      }\n\n      var supported = [];\n\n      switch (this.method) {\n        case JsSIP_C.REGISTER:\n          supported.push('path', 'gruu');\n          break;\n\n        case JsSIP_C.INVITE:\n          if (this.ua.configuration.session_timers) {\n            supported.push('timer');\n          }\n\n          if (this.ua.contact.pub_gruu || this.ua.contact.temp_gruu) {\n            supported.push('gruu');\n          }\n\n          supported.push('ice', 'replaces');\n          break;\n\n        case JsSIP_C.UPDATE:\n          if (this.ua.configuration.session_timers) {\n            supported.push('timer');\n          }\n\n          supported.push('ice');\n          break;\n      }\n\n      supported.push('outbound');\n      var userAgent = this.ua.configuration.user_agent || JsSIP_C.USER_AGENT; // Allow.\n\n      msg += \"Allow: \".concat(JsSIP_C.ALLOWED_METHODS, \"\\r\\n\");\n      msg += \"Supported: \".concat(supported, \"\\r\\n\");\n      msg += \"User-Agent: \".concat(userAgent, \"\\r\\n\");\n\n      if (this.body) {\n        var length = Utils.str_utf8_length(this.body);\n        msg += \"Content-Length: \".concat(length, \"\\r\\n\\r\\n\");\n        msg += this.body;\n      } else {\n        msg += 'Content-Length: 0\\r\\n\\r\\n';\n      }\n\n      return msg;\n    }\n  }, {\n    key: \"clone\",\n    value: function clone() {\n      var request = new OutgoingRequest(this.method, this.ruri, this.ua);\n      Object.keys(this.headers).forEach(function (name) {\n        request.headers[name] = this.headers[name].slice();\n      }, this);\n      request.body = this.body;\n      request.extraHeaders = Utils.cloneArray(this.extraHeaders);\n      request.to = this.to;\n      request.from = this.from;\n      request.call_id = this.call_id;\n      request.cseq = this.cseq;\n      return request;\n    }\n  }]);\n\n  return OutgoingRequest;\n}();\n\nvar InitialOutgoingInviteRequest = /*#__PURE__*/function (_OutgoingRequest) {\n  _inherits(InitialOutgoingInviteRequest, _OutgoingRequest);\n\n  var _super = _createSuper(InitialOutgoingInviteRequest);\n\n  function InitialOutgoingInviteRequest(ruri, ua, params, extraHeaders, body) {\n    var _this;\n\n    _classCallCheck(this, InitialOutgoingInviteRequest);\n\n    _this = _super.call(this, JsSIP_C.INVITE, ruri, ua, params, extraHeaders, body);\n    _this.transaction = null;\n    return _this;\n  }\n\n  _createClass(InitialOutgoingInviteRequest, [{\n    key: \"cancel\",\n    value: function cancel(reason) {\n      this.transaction.cancel(reason);\n    }\n  }, {\n    key: \"clone\",\n    value: function clone() {\n      var request = new InitialOutgoingInviteRequest(this.ruri, this.ua);\n      Object.keys(this.headers).forEach(function (name) {\n        request.headers[name] = this.headers[name].slice();\n      }, this);\n      request.body = this.body;\n      request.extraHeaders = Utils.cloneArray(this.extraHeaders);\n      request.to = this.to;\n      request.from = this.from;\n      request.call_id = this.call_id;\n      request.cseq = this.cseq;\n      request.transaction = this.transaction;\n      return request;\n    }\n  }]);\n\n  return InitialOutgoingInviteRequest;\n}(OutgoingRequest);\n\nvar IncomingMessage = /*#__PURE__*/function () {\n  function IncomingMessage() {\n    _classCallCheck(this, IncomingMessage);\n\n    this.data = null;\n    this.headers = null;\n    this.method = null;\n    this.via = null;\n    this.via_branch = null;\n    this.call_id = null;\n    this.cseq = null;\n    this.from = null;\n    this.from_tag = null;\n    this.to = null;\n    this.to_tag = null;\n    this.body = null;\n    this.sdp = null;\n  }\n  /**\n  * Insert a header of the given name and value into the last position of the\n  * header array.\n  */\n\n\n  _createClass(IncomingMessage, [{\n    key: \"addHeader\",\n    value: function addHeader(name, value) {\n      var header = {\n        raw: value\n      };\n      name = Utils.headerize(name);\n\n      if (this.headers[name]) {\n        this.headers[name].push(header);\n      } else {\n        this.headers[name] = [header];\n      }\n    }\n    /**\n     * Get the value of the given header name at the given position.\n     */\n\n  }, {\n    key: \"getHeader\",\n    value: function getHeader(name) {\n      var header = this.headers[Utils.headerize(name)];\n\n      if (header) {\n        if (header[0]) {\n          return header[0].raw;\n        }\n      } else {\n        return;\n      }\n    }\n    /**\n     * Get the header/s of the given name.\n     */\n\n  }, {\n    key: \"getHeaders\",\n    value: function getHeaders(name) {\n      var headers = this.headers[Utils.headerize(name)];\n      var result = [];\n\n      if (!headers) {\n        return [];\n      }\n\n      var _iterator7 = _createForOfIteratorHelper(headers),\n          _step7;\n\n      try {\n        for (_iterator7.s(); !(_step7 = _iterator7.n()).done;) {\n          var header = _step7.value;\n          result.push(header.raw);\n        }\n      } catch (err) {\n        _iterator7.e(err);\n      } finally {\n        _iterator7.f();\n      }\n\n      return result;\n    }\n    /**\n     * Verify the existence of the given header.\n     */\n\n  }, {\n    key: \"hasHeader\",\n    value: function hasHeader(name) {\n      return this.headers[Utils.headerize(name)] ? true : false;\n    }\n    /**\n    * Parse the given header on the given index.\n    * -param {String} name header name\n    * -param {Number} [idx=0] header index\n    * -returns {Object|undefined} Parsed header object, undefined if the header\n    *  is not present or in case of a parsing error.\n    */\n\n  }, {\n    key: \"parseHeader\",\n    value: function parseHeader(name) {\n      var idx = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      name = Utils.headerize(name);\n\n      if (!this.headers[name]) {\n        logger.debug(\"header \\\"\".concat(name, \"\\\" not present\"));\n        return;\n      } else if (idx >= this.headers[name].length) {\n        logger.debug(\"not so many \\\"\".concat(name, \"\\\" headers present\"));\n        return;\n      }\n\n      var header = this.headers[name][idx];\n      var value = header.raw;\n\n      if (header.parsed) {\n        return header.parsed;\n      } // Substitute '-' by '_' for grammar rule matching.\n\n\n      var parsed = Grammar.parse(value, name.replace(/-/g, '_'));\n\n      if (parsed === -1) {\n        this.headers[name].splice(idx, 1); // delete from headers\n\n        logger.debug(\"error parsing \\\"\".concat(name, \"\\\" header field with value \\\"\").concat(value, \"\\\"\"));\n        return;\n      } else {\n        header.parsed = parsed;\n        return parsed;\n      }\n    }\n    /**\n     * Message Header attribute selector. Alias of parseHeader.\n     * -param {String} name header name\n     * -param {Number} [idx=0] header index\n     * -returns {Object|undefined} Parsed header object, undefined if the header\n     *  is not present or in case of a parsing error.\n     *\n     * -example\n     * message.s('via',3).port\n     */\n\n  }, {\n    key: \"s\",\n    value: function s(name, idx) {\n      return this.parseHeader(name, idx);\n    }\n    /**\n    * Replace the value of the given header by the value.\n    * -param {String} name header name\n    * -param {String} value header value\n    */\n\n  }, {\n    key: \"setHeader\",\n    value: function setHeader(name, value) {\n      var header = {\n        raw: value\n      };\n      this.headers[Utils.headerize(name)] = [header];\n    }\n    /**\n     * Parse the current body as a SDP and store the resulting object\n     * into this.sdp.\n     * -param {Boolean} force: Parse even if this.sdp already exists.\n     *\n     * Returns this.sdp.\n     */\n\n  }, {\n    key: \"parseSDP\",\n    value: function parseSDP(force) {\n      if (!force && this.sdp) {\n        return this.sdp;\n      } else {\n        this.sdp = sdp_transform.parse(this.body || '');\n        return this.sdp;\n      }\n    }\n  }, {\n    key: \"toString\",\n    value: function toString() {\n      return this.data;\n    }\n  }]);\n\n  return IncomingMessage;\n}();\n\nvar IncomingRequest = /*#__PURE__*/function (_IncomingMessage) {\n  _inherits(IncomingRequest, _IncomingMessage);\n\n  var _super2 = _createSuper(IncomingRequest);\n\n  function IncomingRequest(ua) {\n    var _this2;\n\n    _classCallCheck(this, IncomingRequest);\n\n    _this2 = _super2.call(this);\n    _this2.ua = ua;\n    _this2.headers = {};\n    _this2.ruri = null;\n    _this2.transport = null;\n    _this2.server_transaction = null;\n    return _this2;\n  }\n  /**\n  * Stateful reply.\n  * -param {Number} code status code\n  * -param {String} reason reason phrase\n  * -param {Object} headers extra headers\n  * -param {String} body body\n  * -param {Function} [onSuccess] onSuccess callback\n  * -param {Function} [onFailure] onFailure callback\n  */\n\n\n  _createClass(IncomingRequest, [{\n    key: \"reply\",\n    value: function reply(code, reason, extraHeaders, body, onSuccess, onFailure) {\n      var supported = [];\n      var to = this.getHeader('To');\n      code = code || null;\n      reason = reason || null; // Validate code and reason values.\n\n      if (!code || code < 100 || code > 699) {\n        throw new TypeError(\"Invalid status_code: \".concat(code));\n      } else if (reason && typeof reason !== 'string' && !(reason instanceof String)) {\n        throw new TypeError(\"Invalid reason_phrase: \".concat(reason));\n      }\n\n      reason = reason || JsSIP_C.REASON_PHRASE[code] || '';\n      extraHeaders = Utils.cloneArray(extraHeaders);\n      var response = \"SIP/2.0 \".concat(code, \" \").concat(reason, \"\\r\\n\");\n\n      if (this.method === JsSIP_C.INVITE && code > 100 && code <= 200) {\n        var headers = this.getHeaders('record-route');\n\n        var _iterator8 = _createForOfIteratorHelper(headers),\n            _step8;\n\n        try {\n          for (_iterator8.s(); !(_step8 = _iterator8.n()).done;) {\n            var header = _step8.value;\n            response += \"Record-Route: \".concat(header, \"\\r\\n\");\n          }\n        } catch (err) {\n          _iterator8.e(err);\n        } finally {\n          _iterator8.f();\n        }\n      }\n\n      var vias = this.getHeaders('via');\n\n      var _iterator9 = _createForOfIteratorHelper(vias),\n          _step9;\n\n      try {\n        for (_iterator9.s(); !(_step9 = _iterator9.n()).done;) {\n          var via = _step9.value;\n          response += \"Via: \".concat(via, \"\\r\\n\");\n        }\n      } catch (err) {\n        _iterator9.e(err);\n      } finally {\n        _iterator9.f();\n      }\n\n      if (!this.to_tag && code > 100) {\n        to += \";tag=\".concat(Utils.newTag());\n      } else if (this.to_tag && !this.s('to').hasParam('tag')) {\n        to += \";tag=\".concat(this.to_tag);\n      }\n\n      response += \"To: \".concat(to, \"\\r\\n\");\n      response += \"From: \".concat(this.getHeader('From'), \"\\r\\n\");\n      response += \"Call-ID: \".concat(this.call_id, \"\\r\\n\");\n      response += \"CSeq: \".concat(this.cseq, \" \").concat(this.method, \"\\r\\n\");\n\n      var _iterator10 = _createForOfIteratorHelper(extraHeaders),\n          _step10;\n\n      try {\n        for (_iterator10.s(); !(_step10 = _iterator10.n()).done;) {\n          var _header2 = _step10.value;\n          response += \"\".concat(_header2.trim(), \"\\r\\n\");\n        } // Supported.\n\n      } catch (err) {\n        _iterator10.e(err);\n      } finally {\n        _iterator10.f();\n      }\n\n      switch (this.method) {\n        case JsSIP_C.INVITE:\n          if (this.ua.configuration.session_timers) {\n            supported.push('timer');\n          }\n\n          if (this.ua.contact.pub_gruu || this.ua.contact.temp_gruu) {\n            supported.push('gruu');\n          }\n\n          supported.push('ice', 'replaces');\n          break;\n\n        case JsSIP_C.UPDATE:\n          if (this.ua.configuration.session_timers) {\n            supported.push('timer');\n          }\n\n          if (body) {\n            supported.push('ice');\n          }\n\n          supported.push('replaces');\n      }\n\n      supported.push('outbound'); // Allow and Accept.\n\n      if (this.method === JsSIP_C.OPTIONS) {\n        response += \"Allow: \".concat(JsSIP_C.ALLOWED_METHODS, \"\\r\\n\");\n        response += \"Accept: \".concat(JsSIP_C.ACCEPTED_BODY_TYPES, \"\\r\\n\");\n      } else if (code === 405) {\n        response += \"Allow: \".concat(JsSIP_C.ALLOWED_METHODS, \"\\r\\n\");\n      } else if (code === 415) {\n        response += \"Accept: \".concat(JsSIP_C.ACCEPTED_BODY_TYPES, \"\\r\\n\");\n      }\n\n      response += \"Supported: \".concat(supported, \"\\r\\n\");\n\n      if (body) {\n        var length = Utils.str_utf8_length(body);\n        response += 'Content-Type: application/sdp\\r\\n';\n        response += \"Content-Length: \".concat(length, \"\\r\\n\\r\\n\");\n        response += body;\n      } else {\n        response += \"Content-Length: \".concat(0, \"\\r\\n\\r\\n\");\n      }\n\n      this.server_transaction.receiveResponse(code, response, onSuccess, onFailure);\n    }\n    /**\n    * Stateless reply.\n    * -param {Number} code status code\n    * -param {String} reason reason phrase\n    */\n\n  }, {\n    key: \"reply_sl\",\n    value: function reply_sl() {\n      var code = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n      var reason = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      var vias = this.getHeaders('via'); // Validate code and reason values.\n\n      if (!code || code < 100 || code > 699) {\n        throw new TypeError(\"Invalid status_code: \".concat(code));\n      } else if (reason && typeof reason !== 'string' && !(reason instanceof String)) {\n        throw new TypeError(\"Invalid reason_phrase: \".concat(reason));\n      }\n\n      reason = reason || JsSIP_C.REASON_PHRASE[code] || '';\n      var response = \"SIP/2.0 \".concat(code, \" \").concat(reason, \"\\r\\n\");\n\n      var _iterator11 = _createForOfIteratorHelper(vias),\n          _step11;\n\n      try {\n        for (_iterator11.s(); !(_step11 = _iterator11.n()).done;) {\n          var via = _step11.value;\n          response += \"Via: \".concat(via, \"\\r\\n\");\n        }\n      } catch (err) {\n        _iterator11.e(err);\n      } finally {\n        _iterator11.f();\n      }\n\n      var to = this.getHeader('To');\n\n      if (!this.to_tag && code > 100) {\n        to += \";tag=\".concat(Utils.newTag());\n      } else if (this.to_tag && !this.s('to').hasParam('tag')) {\n        to += \";tag=\".concat(this.to_tag);\n      }\n\n      response += \"To: \".concat(to, \"\\r\\n\");\n      response += \"From: \".concat(this.getHeader('From'), \"\\r\\n\");\n      response += \"Call-ID: \".concat(this.call_id, \"\\r\\n\");\n      response += \"CSeq: \".concat(this.cseq, \" \").concat(this.method, \"\\r\\n\");\n      response += \"Content-Length: \".concat(0, \"\\r\\n\\r\\n\");\n      this.transport.send(response);\n    }\n  }]);\n\n  return IncomingRequest;\n}(IncomingMessage);\n\nvar IncomingResponse = /*#__PURE__*/function (_IncomingMessage2) {\n  _inherits(IncomingResponse, _IncomingMessage2);\n\n  var _super3 = _createSuper(IncomingResponse);\n\n  function IncomingResponse() {\n    var _this3;\n\n    _classCallCheck(this, IncomingResponse);\n\n    _this3 = _super3.call(this);\n    _this3.headers = {};\n    _this3.status_code = null;\n    _this3.reason_phrase = null;\n    return _this3;\n  }\n\n  return IncomingResponse;\n}(IncomingMessage);\n\nmodule.exports = {\n  OutgoingRequest: OutgoingRequest,\n  InitialOutgoingInviteRequest: InitialOutgoingInviteRequest,\n  IncomingRequest: IncomingRequest,\n  IncomingResponse: IncomingResponse\n};"]},"metadata":{},"sourceType":"script"}