{"ast":null,"code":"\"use strict\";\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nvar JsSIP_C = require('../Constants');\n\nvar Transactions = require('../Transactions');\n\nvar RTCSession = require('../RTCSession');\n\nvar RequestSender = require('../RequestSender'); // Default event handlers.\n\n\nvar EventHandlers = {\n  onRequestTimeout: function onRequestTimeout() {},\n  onTransportError: function onTransportError() {},\n  onSuccessResponse: function onSuccessResponse() {},\n  onErrorResponse: function onErrorResponse() {},\n  onAuthenticated: function onAuthenticated() {},\n  onDialogError: function onDialogError() {}\n};\n\nmodule.exports = /*#__PURE__*/function () {\n  function DialogRequestSender(dialog, request, eventHandlers) {\n    _classCallCheck(this, DialogRequestSender);\n\n    this._dialog = dialog;\n    this._ua = dialog._ua;\n    this._request = request;\n    this._eventHandlers = eventHandlers; // RFC3261 14.1 Modifying an Existing Session. UAC Behavior.\n\n    this._reattempt = false;\n    this._reattemptTimer = null; // Define the undefined handlers.\n\n    for (var handler in EventHandlers) {\n      if (Object.prototype.hasOwnProperty.call(EventHandlers, handler)) {\n        if (!this._eventHandlers[handler]) {\n          this._eventHandlers[handler] = EventHandlers[handler];\n        }\n      }\n    }\n  }\n\n  _createClass(DialogRequestSender, [{\n    key: \"send\",\n    value: function send() {\n      var _this = this;\n\n      var request_sender = new RequestSender(this._ua, this._request, {\n        onRequestTimeout: function onRequestTimeout() {\n          _this._eventHandlers.onRequestTimeout();\n        },\n        onTransportError: function onTransportError() {\n          _this._eventHandlers.onTransportError();\n        },\n        onAuthenticated: function onAuthenticated(request) {\n          _this._eventHandlers.onAuthenticated(request);\n        },\n        onReceiveResponse: function onReceiveResponse(response) {\n          _this._receiveResponse(response);\n        }\n      });\n      request_sender.send(); // RFC3261 14.2 Modifying an Existing Session -UAC BEHAVIOR-.\n\n      if ((this._request.method === JsSIP_C.INVITE || this._request.method === JsSIP_C.UPDATE && this._request.body) && request_sender.clientTransaction.state !== Transactions.C.STATUS_TERMINATED) {\n        this._dialog.uac_pending_reply = true;\n\n        var stateChanged = function stateChanged() {\n          if (request_sender.clientTransaction.state === Transactions.C.STATUS_ACCEPTED || request_sender.clientTransaction.state === Transactions.C.STATUS_COMPLETED || request_sender.clientTransaction.state === Transactions.C.STATUS_TERMINATED) {\n            request_sender.clientTransaction.removeListener('stateChanged', stateChanged);\n            _this._dialog.uac_pending_reply = false;\n          }\n        };\n\n        request_sender.clientTransaction.on('stateChanged', stateChanged);\n      }\n    }\n  }, {\n    key: \"_receiveResponse\",\n    value: function _receiveResponse(response) {\n      var _this2 = this; // RFC3261 12.2.1.2 408 or 481 is received for a request within a dialog.\n\n\n      if (response.status_code === 408 || response.status_code === 481) {\n        this._eventHandlers.onDialogError(response);\n      } else if (response.method === JsSIP_C.INVITE && response.status_code === 491) {\n        if (this._reattempt) {\n          if (response.status_code >= 200 && response.status_code < 300) {\n            this._eventHandlers.onSuccessResponse(response);\n          } else if (response.status_code >= 300) {\n            this._eventHandlers.onErrorResponse(response);\n          }\n        } else {\n          this._request.cseq = this._dialog.local_seqnum += 1;\n          this._reattemptTimer = setTimeout(function () {\n            // TODO: look at dialog state instead.\n            if (_this2._dialog.owner.status !== RTCSession.C.STATUS_TERMINATED) {\n              _this2._reattempt = true;\n\n              _this2._request_sender.send();\n            }\n          }, 1000);\n        }\n      } else if (response.status_code >= 200 && response.status_code < 300) {\n        this._eventHandlers.onSuccessResponse(response);\n      } else if (response.status_code >= 300) {\n        this._eventHandlers.onErrorResponse(response);\n      }\n    }\n  }, {\n    key: \"request\",\n    get: function get() {\n      return this._request;\n    }\n  }]);\n\n  return DialogRequestSender;\n}();","map":{"version":3,"sources":["/Users/tuphan/Desktop/gcallstest/node_modules/jssip/lib-es5/Dialog/RequestSender.js"],"names":["_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","prototype","JsSIP_C","require","Transactions","RTCSession","RequestSender","EventHandlers","onRequestTimeout","onTransportError","onSuccessResponse","onErrorResponse","onAuthenticated","onDialogError","module","exports","DialogRequestSender","dialog","request","eventHandlers","_dialog","_ua","_request","_eventHandlers","_reattempt","_reattemptTimer","handler","hasOwnProperty","call","value","send","_this","request_sender","onReceiveResponse","response","_receiveResponse","method","INVITE","UPDATE","body","clientTransaction","state","C","STATUS_TERMINATED","uac_pending_reply","stateChanged","STATUS_ACCEPTED","STATUS_COMPLETED","removeListener","on","_this2","status_code","cseq","local_seqnum","setTimeout","owner","status","_request_sender","get"],"mappings":"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","sourcesContent":["\"use strict\";\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nvar JsSIP_C = require('../Constants');\n\nvar Transactions = require('../Transactions');\n\nvar RTCSession = require('../RTCSession');\n\nvar RequestSender = require('../RequestSender'); // Default event handlers.\n\n\nvar EventHandlers = {\n  onRequestTimeout: function onRequestTimeout() {},\n  onTransportError: function onTransportError() {},\n  onSuccessResponse: function onSuccessResponse() {},\n  onErrorResponse: function onErrorResponse() {},\n  onAuthenticated: function onAuthenticated() {},\n  onDialogError: function onDialogError() {}\n};\n\nmodule.exports = /*#__PURE__*/function () {\n  function DialogRequestSender(dialog, request, eventHandlers) {\n    _classCallCheck(this, DialogRequestSender);\n\n    this._dialog = dialog;\n    this._ua = dialog._ua;\n    this._request = request;\n    this._eventHandlers = eventHandlers; // RFC3261 14.1 Modifying an Existing Session. UAC Behavior.\n\n    this._reattempt = false;\n    this._reattemptTimer = null; // Define the undefined handlers.\n\n    for (var handler in EventHandlers) {\n      if (Object.prototype.hasOwnProperty.call(EventHandlers, handler)) {\n        if (!this._eventHandlers[handler]) {\n          this._eventHandlers[handler] = EventHandlers[handler];\n        }\n      }\n    }\n  }\n\n  _createClass(DialogRequestSender, [{\n    key: \"send\",\n    value: function send() {\n      var _this = this;\n\n      var request_sender = new RequestSender(this._ua, this._request, {\n        onRequestTimeout: function onRequestTimeout() {\n          _this._eventHandlers.onRequestTimeout();\n        },\n        onTransportError: function onTransportError() {\n          _this._eventHandlers.onTransportError();\n        },\n        onAuthenticated: function onAuthenticated(request) {\n          _this._eventHandlers.onAuthenticated(request);\n        },\n        onReceiveResponse: function onReceiveResponse(response) {\n          _this._receiveResponse(response);\n        }\n      });\n      request_sender.send(); // RFC3261 14.2 Modifying an Existing Session -UAC BEHAVIOR-.\n\n      if ((this._request.method === JsSIP_C.INVITE || this._request.method === JsSIP_C.UPDATE && this._request.body) && request_sender.clientTransaction.state !== Transactions.C.STATUS_TERMINATED) {\n        this._dialog.uac_pending_reply = true;\n\n        var stateChanged = function stateChanged() {\n          if (request_sender.clientTransaction.state === Transactions.C.STATUS_ACCEPTED || request_sender.clientTransaction.state === Transactions.C.STATUS_COMPLETED || request_sender.clientTransaction.state === Transactions.C.STATUS_TERMINATED) {\n            request_sender.clientTransaction.removeListener('stateChanged', stateChanged);\n            _this._dialog.uac_pending_reply = false;\n          }\n        };\n\n        request_sender.clientTransaction.on('stateChanged', stateChanged);\n      }\n    }\n  }, {\n    key: \"_receiveResponse\",\n    value: function _receiveResponse(response) {\n      var _this2 = this;\n\n      // RFC3261 12.2.1.2 408 or 481 is received for a request within a dialog.\n      if (response.status_code === 408 || response.status_code === 481) {\n        this._eventHandlers.onDialogError(response);\n      } else if (response.method === JsSIP_C.INVITE && response.status_code === 491) {\n        if (this._reattempt) {\n          if (response.status_code >= 200 && response.status_code < 300) {\n            this._eventHandlers.onSuccessResponse(response);\n          } else if (response.status_code >= 300) {\n            this._eventHandlers.onErrorResponse(response);\n          }\n        } else {\n          this._request.cseq = this._dialog.local_seqnum += 1;\n          this._reattemptTimer = setTimeout(function () {\n            // TODO: look at dialog state instead.\n            if (_this2._dialog.owner.status !== RTCSession.C.STATUS_TERMINATED) {\n              _this2._reattempt = true;\n\n              _this2._request_sender.send();\n            }\n          }, 1000);\n        }\n      } else if (response.status_code >= 200 && response.status_code < 300) {\n        this._eventHandlers.onSuccessResponse(response);\n      } else if (response.status_code >= 300) {\n        this._eventHandlers.onErrorResponse(response);\n      }\n    }\n  }, {\n    key: \"request\",\n    get: function get() {\n      return this._request;\n    }\n  }]);\n\n  return DialogRequestSender;\n}();"]},"metadata":{},"sourceType":"script"}